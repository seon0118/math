<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊïôÂ∏´Êï∏Â≠∏Ëß£È°åÈÅäÊà≤Á≥ªÁµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .header h1 {
            color: #4a5568;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #718096;
            font-size: 1.1em;
        }

        .nav-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #718096;
            transition: all 0.3s ease;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .nav-tab:hover:not(.active) {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        .tab-content {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }

        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
        }

        .btn.secondary {
            background: linear-gradient(135deg, #48bb78, #38a169);
        }

        .btn.danger {
            background: linear-gradient(135deg, #f56565, #e53e3e);
        }

        .file-upload {
            position: relative;
            display: inline-block;
            cursor: pointer;
            width: 100%;
        }

        .file-upload input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-upload-label {
            display: block;
            padding: 12px;
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            text-align: center;
            color: #718096;
            transition: all 0.3s ease;
        }

        .file-upload:hover .file-upload-label {
            border-color: #667eea;
            color: #667eea;
        }

        .image-preview {
            max-width: 200px;
            max-height: 200px;
            border-radius: 8px;
            margin-top: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .question-item {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
        }

        .question-item h4 {
            color: #4a5568;
            margin-bottom: 10px;
        }

        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #f56565;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 16px;
        }

        .game-area {
            text-align: center;
        }

        .question-display {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            min-height: 200px;
        }

        .question-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .answer-input {
            width: 100%;
            max-width: 400px;
            padding: 15px;
            font-size: 18px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }

        .game-stats {
            display: flex;
            justify-content: space-around;
            background: #f7fafc;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 14px;
            color: #718096;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e2e8f0;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }

        .feedback {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
        }

        .feedback.correct {
            background: #c6f6d5;
            color: #22543d;
            border: 2px solid #48bb78;
        }

        .feedback.incorrect {
            background: #fed7d7;
            color: #742a2a;
            border: 2px solid #f56565;
        }

        .completion-screen {
            text-align: center;
            padding: 40px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px;
        }

        .completion-title {
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        .completion-stats {
            font-size: 1.2em;
            margin-bottom: 30px;
        }

        .sample-file {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .sample-file h4 {
            color: #4a5568;
            margin-bottom: 15px;
        }

        .sample-code {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .tab-content {
                padding: 20px;
            }
            
            .game-stats {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö ÊïôÂ∏´Êï∏Â≠∏Ëß£È°åÈÅäÊà≤Á≥ªÁµ±</h1>
            <p>ÂâµÂª∫‰∫íÂãïÂºèÊï∏Â≠∏È°åÁõÆÔºåÊîØÊè¥ÂúñÁâá‰∏äÂÇ≥ËàáÈÅäÊà≤Â≠òÊ™îÂäüËÉΩ</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('create')">ÂâµÂª∫È°åÁõÆ</button>
            <button class="nav-tab" onclick="switchTab('manage')">ÁÆ°ÁêÜÈ°åÁõÆ</button>
            <button class="nav-tab" onclick="switchTab('game')">ÈÅäÊà≤Ê®°Âºè</button>
            <button class="nav-tab" onclick="switchTab('import')">ÂåØÂÖ•È°åÁõÆ</button>
            <button class="nav-tab" onclick="switchTab('save')">Â≠òÊ™îÁÆ°ÁêÜ</button>
        </div>

        <!-- ÂâµÂª∫È°åÁõÆÊ®ôÁ±§ -->
        <div id="createTab" class="tab-content active">
            <h2>ÂâµÂª∫Êñ∞È°åÁõÆ</h2>
            <form id="questionForm">
                <div class="form-group">
                    <label for="questionText">È°åÁõÆÂÖßÂÆπÔºö</label>
                    <textarea id="questionText" placeholder="Ëº∏ÂÖ•Êï∏Â≠∏È°åÁõÆ..." required></textarea>
                </div>

                <div class="form-group">
                    <label for="questionImage">‰∏äÂÇ≥ÂúñÁâáÔºàÂèØÈÅ∏ÔºâÔºö</label>
                    <div class="file-upload">
                        <input type="file" id="questionImage" accept="image/*" onchange="previewImage(this)">
                        <label for="questionImage" class="file-upload-label">
                            üì∏ ÈªûÊìä‰∏äÂÇ≥ÂúñÁâáÊàñÊãñÊãΩÂúñÁâáÂà∞Ê≠§Ëôï
                        </label>
                    </div>
                    <img id="imagePreview" class="image-preview hidden" alt="ÂúñÁâáÈ†êË¶Ω">
                </div>

                <div class="form-group">
                    <label for="correctAnswer">Ê≠£Á¢∫Á≠îÊ°àÔºö</label>
                    <input type="text" id="correctAnswer" placeholder="Ëº∏ÂÖ•Ê≠£Á¢∫Á≠îÊ°à..." required>
                </div>

                <div class="form-group">
                    <label for="difficulty">Èõ£Â∫¶Á≠âÁ¥öÔºö</label>
                    <select id="difficulty">
                        <option value="1">Á∞°ÂñÆ</option>
                        <option value="2">ÊôÆÈÄö</option>
                        <option value="3">Âõ∞Èõ£</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="explanation">Ëß£È°åË™™ÊòéÔºàÂèØÈÅ∏ÔºâÔºö</label>
                    <textarea id="explanation" placeholder="Ëº∏ÂÖ•Ëß£È°åÊ≠•È©üÊàñË™™Êòé..."></textarea>
                </div>

                <button type="submit" class="btn">Ê∑ªÂä†È°åÁõÆ</button>
                <button type="button" class="btn secondary" onclick="clearForm()">Ê∏ÖÁ©∫Ë°®ÂñÆ</button>
            </form>
        </div>

        <!-- ÁÆ°ÁêÜÈ°åÁõÆÊ®ôÁ±§ -->
        <div id="manageTab" class="tab-content">
            <h2>È°åÁõÆÁÆ°ÁêÜ</h2>
            <div style="margin-bottom: 20px;">
                <button class="btn secondary" onclick="exportQuestions()">ÂåØÂá∫È°åÁõÆ</button>
                <button class="btn danger" onclick="clearAllQuestions()">Ê∏ÖÁ©∫ÊâÄÊúâÈ°åÁõÆ</button>
                <span style="margin-left: 20px; color: #718096;">
                    ÁõÆÂâçÈ°åÁõÆÊï∏ÈáèÔºö<span id="questionCount">0</span>
                </span>
            </div>
            <div id="questionList"></div>
        </div>

        <!-- ÈÅäÊà≤Ê®°ÂºèÊ®ôÁ±§ -->
        <div id="gameTab" class="tab-content">
            <div id="gameSetup">
                <h2>ÈÅäÊà≤Ë®≠ÂÆö</h2>
                <div class="form-group">
                    <label for="gameMode">ÈÅäÊà≤Ê®°ÂºèÔºö</label>
                    <select id="gameMode">
                        <option value="all">ÊâÄÊúâÈ°åÁõÆ</option>
                        <option value="difficulty">ÊåâÈõ£Â∫¶ÁØ©ÈÅ∏</option>
                        <option value="random">Èö®Ê©üÊ®°Âºè</option>
                    </select>
                </div>
                <div class="form-group" id="difficultyFilter" style="display: none;">
                    <label for="selectedDifficulty">ÈÅ∏ÊìáÈõ£Â∫¶Ôºö</label>
                    <select id="selectedDifficulty">
                        <option value="1">Á∞°ÂñÆ</option>
                        <option value="2">ÊôÆÈÄö</option>
                        <option value="3">Âõ∞Èõ£</option>
                    </select>
                </div>
                <div class="form-group" id="randomCount" style="display: none;">
                    <label for="randomQuestionCount">È°åÁõÆÊï∏ÈáèÔºö</label>
                    <input type="number" id="randomQuestionCount" value="5" min="1" max="20">
                </div>
                <button class="btn" onclick="startGame()">ÈñãÂßãÈÅäÊà≤</button>
            </div>

            <div id="gamePlay" class="hidden">
                <div class="game-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="currentQuestion">1</div>
                        <div class="stat-label">ÁõÆÂâçÈ°åÁõÆ</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalQuestions">10</div>
                        <div class="stat-label">Á∏ΩÈ°åÁõÆÊï∏</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="correctCount">0</div>
                        <div class="stat-label">Á≠îÂ∞çÈ°åÊï∏</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="timer">00:00</div>
                        <div class="stat-label">ÈÅäÊà≤ÊôÇÈñì</div>
                    </div>
                </div>

                <div class="progress-bar">
                    <div class="progress-fill" id="gameProgress"></div>
                </div>

                <div class="question-display">
                    <div id="currentQuestionText"></div>
                    <img id="currentQuestionImage" class="question-image hidden" alt="È°åÁõÆÂúñÁâá">
                </div>

                <input type="text" id="gameAnswer" class="answer-input" placeholder="Ëº∏ÂÖ•Á≠îÊ°à..." onkeypress="handleKeyPress(event)">
                
                <div>
                    <button class="btn" onclick="submitAnswer()">Êèê‰∫§Á≠îÊ°à</button>
                    <button class="btn secondary" onclick="skipQuestion()">Ë∑≥ÈÅéÈ°åÁõÆ</button>
                    <button class="btn danger" onclick="endGame()">ÁµêÊùüÈÅäÊà≤</button>
                </div>

                <div id="gameFeedback" class="feedback hidden"></div>
            </div>

            <div id="gameComplete" class="completion-screen hidden">
                <h2 class="completion-title">üéâ ÈÅäÊà≤ÂÆåÊàêÔºÅ</h2>
                <div class="completion-stats" id="finalStats"></div>
                <button class="btn" onclick="restartGame()">ÈáçÊñ∞ÈñãÂßã</button>
                <button class="btn secondary" onclick="saveGameResult()">‰øùÂ≠òÊàêÁ∏æ</button>
            </div>
        </div>

        <!-- ÂåØÂÖ•È°åÁõÆÊ®ôÁ±§ -->
        <div id="importTab" class="tab-content">
            <h2>ÂåØÂÖ•È°åÁõÆ</h2>
            
            <div class="form-group">
                <label for="importFile">ÈÅ∏ÊìáÈ°åÁõÆÊ™îÊ°àÔºö</label>
                <div class="file-upload">
                    <input type="file" id="importFile" accept=".json" onchange="handleFileImport(this)">
                    <label for="importFile" class="file-upload-label">
                        üìÅ ÈÅ∏Êìá JSON Ê™îÊ°à
                    </label>
                </div>
            </div>

            <div class="sample-file">
                <h4>ÁØÑ‰æãÊ™îÊ°àÊ†ºÂºèÔºö</h4>
                <div class="sample-code">
[
  {
    "question": "Ë®àÁÆó 2 + 3 = ?",
    "answer": "5",
    "difficulty": 1,
    "explanation": "ÈÄôÊòØÂü∫Êú¨ÁöÑÂä†Ê≥ïÈÅãÁÆó",
    "image": ""
  },
  {
    "question": "Ëß£ÊñπÁ®ãÂºèÔºö2x + 5 = 15",
    "answer": "5",
    "difficulty": 2,
    "explanation": "ÁßªÈ†ÖÂæóÂà∞ 2x = 10ÔºåÊâÄ‰ª• x = 5",
    "image": ""
  },
  {
    "question": "Ë®àÁÆóÂúìÂΩ¢Èù¢Á©çÔºåÂçäÂæë = 3",
    "answer": "28.27",
    "difficulty": 3,
    "explanation": "‰ΩøÁî®ÂÖ¨Âºè A = œÄr¬≤ÔºåA = œÄ √ó 3¬≤ ‚âà 28.27",
    "image": ""
  }
]
                </div>
            </div>

            <button class="btn secondary" onclick="downloadSampleFile()">‰∏ãËºâÁØÑ‰æãÊ™îÊ°à</button>
        </div>

        <!-- Â≠òÊ™îÁÆ°ÁêÜÊ®ôÁ±§ -->
        <div id="saveTab" class="tab-content">
            <h2>Â≠òÊ™îÁÆ°ÁêÜ</h2>
            
            <div style="margin-bottom: 20px;">
                <button class="btn" onclick="saveCurrentState()">‰øùÂ≠òÁõÆÂâçÁãÄÊÖã</button>
                <button class="btn secondary" onclick="loadGameState()">ËºâÂÖ•Â≠òÊ™î</button>
                <button class="btn danger" onclick="clearAllSaves()">Ê∏ÖÁ©∫ÊâÄÊúâÂ≠òÊ™î</button>
            </div>

            <div id="saveList"></div>
        </div>
    </div>

    <script>
        // ÂÖ®ÂüüËÆäÊï∏
        let questions = [];
        let gameState = {
            currentQuestionIndex: 0,
            correctAnswers: 0,
            gameQuestions: [],
            startTime: null,
            timerInterval: null,
            isGameActive: false
        };

        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            loadQuestions();
            updateQuestionCount();
            loadSaveList();
            
            // ÈÅäÊà≤Ê®°ÂºèÈÅ∏Êìá‰∫ã‰ª∂Áõ£ËÅΩ
            document.getElementById('gameMode').addEventListener('change', function() {
                const mode = this.value;
                document.getElementById('difficultyFilter').style.display = mode === 'difficulty' ? 'block' : 'none';
                document.getElementById('randomCount').style.display = mode === 'random' ? 'block' : 'none';
            });

            // Ë°®ÂñÆÊèê‰∫§‰∫ã‰ª∂
            document.getElementById('questionForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addQuestion();
            });
        });

        // Ê®ôÁ±§ÂàáÊèõ
        function switchTab(tabName) {
            // Èö±ËóèÊâÄÊúâÊ®ôÁ±§ÂÖßÂÆπ
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ÁßªÈô§ÊâÄÊúâÊ®ôÁ±§ÁöÑ active È°û
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // È°ØÁ§∫ÈÅ∏‰∏≠ÁöÑÊ®ôÁ±§
            document.getElementById(tabName + 'Tab').classList.add('active');
            event.target.classList.add('active');
            
            // Êõ¥Êñ∞Áõ∏ÈóúÂÖßÂÆπ
            if (tabName === 'manage') {
                displayQuestions();
            } else if (tabName === 'save') {
                loadSaveList();
            }
        }

        // ÂúñÁâáÈ†êË¶Ω
        function previewImage(input) {
            const preview = document.getElementById('imagePreview');
            
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.classList.remove('hidden');
                };
                
                reader.readAsDataURL(input.files[0]);
            } else {
                preview.classList.add('hidden');
            }
        }

        // Ê∑ªÂä†È°åÁõÆ
        function addQuestion() {
            const questionText = document.getElementById('questionText').value;
            const imageFile = document.getElementById('questionImage').files[0];
            const correctAnswer = document.getElementById('correctAnswer').value;
            const difficulty = parseInt(document.getElementById('difficulty').value);
            const explanation = document.getElementById('explanation').value;

            const question = {
                id: Date.now(),
                question: questionText,
                answer: correctAnswer.toLowerCase(),
                difficulty: difficulty,
                explanation: explanation,
                image: ''
            };

            if (imageFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    question.image = e.target.result;
                    questions.push(question);
                    saveQuestions();
                    updateQuestionCount();
                    clearForm();
                    alert('È°åÁõÆÊ∑ªÂä†ÊàêÂäüÔºÅ');
                };
                reader.readAsDataURL(imageFile);
            } else {
                questions.push(question);
                saveQuestions();
                updateQuestionCount();
                clearForm();
                alert('È°åÁõÆÊ∑ªÂä†ÊàêÂäüÔºÅ');
            }
        }

        // Ê∏ÖÁ©∫Ë°®ÂñÆ
        function clearForm() {
            document.getElementById('questionForm').reset();
            document.getElementById('imagePreview').classList.add('hidden');
        }

        // ‰øùÂ≠òÈ°åÁõÆÂà∞Êú¨Âú∞Â≠òÂÑ≤
        function saveQuestions() {
            const questionsData = JSON.stringify(questions);
            // ‰ΩøÁî®ËÆäÊï∏Ê®°Êì¨Â≠òÂÑ≤
            window.questionsStorage = questionsData;
        }

        // ËºâÂÖ•È°åÁõÆ
        function loadQuestions() {
            try {
                const questionsData = window.questionsStorage;
                if (questionsData) {
                    questions = JSON.parse(questionsData);
                }
            } catch (error) {
                console.error('ËºâÂÖ•È°åÁõÆÂ§±Êïó:', error);
                questions = [];
            }
        }

        // Êõ¥Êñ∞È°åÁõÆÊï∏ÈáèÈ°ØÁ§∫
        function updateQuestionCount() {
            document.getElementById('questionCount').textContent = questions.length;
        }

        // È°ØÁ§∫È°åÁõÆÂàóË°®
        function displayQuestions() {
            const container = document.getElementById('questionList');
            container.innerHTML = '';

            if (questions.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #718096;">Â∞öÊú™Êúâ‰ªª‰ΩïÈ°åÁõÆ</p>';
                return;
            }

            questions.forEach((question, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-item';
                
                const difficultyText = ['', 'Á∞°ÂñÆ', 'ÊôÆÈÄö', 'Âõ∞Èõ£'][question.difficulty];
                
                questionDiv.innerHTML = `
                    <button class="delete-btn" onclick="deleteQuestion(${question.id})">&times;</button>
                    <h4>È°åÁõÆ ${index + 1} (${difficultyText})</h4>
                    <p><strong>È°åÁõÆÔºö</strong>${question.question}</p>
                    ${question.image ? `<img src="${question.image}" alt="È°åÁõÆÂúñÁâá" style="max-width: 150px; margin: 10px 0; border-radius: 5px;">` : ''}
                    <p><strong>Á≠îÊ°àÔºö</strong>${question.answer}</p>
                    ${question.explanation ? `<p><strong>Ë™™ÊòéÔºö</strong>${question.explanation}</p>` : ''}
                `;
                
                container.appendChild(questionDiv);
            });
        }

        // Âà™Èô§È°åÁõÆ
        function deleteQuestion(id) {
            if (confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§ÈÄôÂÄãÈ°åÁõÆÂóéÔºü')) {
                questions = questions.filter(q => q.id !== id);
                saveQuestions();
                updateQuestionCount();
                displayQuestions();
            }
        }

        // Ê∏ÖÁ©∫ÊâÄÊúâÈ°åÁõÆ
        function clearAllQuestions() {
            if (confirm('Á¢∫ÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÈ°åÁõÆÂóéÔºüÊ≠§Êìç‰ΩúÁÑ°Ê≥ïÂæ©ÂéüÔºÅ')) {
                questions = [];
                saveQuestions();
                updateQuestionCount();
                displayQuestions();
            }
        }

        // ÂåØÂá∫È°åÁõÆ
        function exportQuestions() {
            if (questions.length === 0) {
                alert('Ê≤íÊúâÈ°åÁõÆÂèØ‰ª•ÂåØÂá∫ÔºÅ');
                return;
            }

            const dataStr = JSON.stringify(questions, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'math_questions.json';
            link.click();
        }

        // ËôïÁêÜÊ™îÊ°àÂåØÂÖ•
        function handleFileImport(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedQuestions = JSON.parse(e.target.result);
                    
                    if (!Array.isArray(importedQuestions)) {
                        throw new Error('Ê™îÊ°àÊ†ºÂºèÈåØË™§ÔºöÂøÖÈ†àÊòØÈô£ÂàóÊ†ºÂºè');
                    }

                    // È©óË≠âÈ°åÁõÆÊ†ºÂºè
                    const validQuestions = importedQuestions.filter(q => 
                        q.question && q.answer && q.difficulty
                    ).map(q => ({
                        id: Date.now() + Math.random(),
                        question: q.question,
                        answer: q.answer.toString().toLowerCase(),
                        difficulty: parseInt(q.difficulty) || 1,
                        explanation: q.explanation || '',
                        image: q.image || ''
                    }));

                    if (validQuestions.length === 0) {
                        throw new Error('Ê≤íÊúâÊâæÂà∞ÊúâÊïàÁöÑÈ°åÁõÆ');
                    }

                    questions = questions.concat(validQuestions);
                    saveQuestions();
                    updateQuestionCount();
                    
                    alert(`ÊàêÂäüÂåØÂÖ• ${validQuestions.length} ÈÅìÈ°åÁõÆÔºÅ`);
                    
                } catch (error) {
                    alert('ÂåØÂÖ•Â§±ÊïóÔºö' + error.message);
                }
            };
            reader.readAsText(file);
        }

        // ‰∏ãËºâÁØÑ‰æãÊ™îÊ°à
        function downloadSampleFile() {
            const sampleData = [
                {
                    "question": "Ë®àÁÆó 2 + 3 = ?",
                    "answer": "5",
                    "difficulty": 1,
                    "explanation": "ÈÄôÊòØÂü∫Êú¨ÁöÑÂä†Ê≥ïÈÅãÁÆó",
                    "image": ""
                },
                {
                    "question": "Ëß£ÊñπÁ®ãÂºèÔºö2x + 5 = 15",
                    "answer": "5",
                    "difficulty": 2,
                    "explanation": "ÁßªÈ†ÖÂæóÂà∞ 2x = 10ÔºåÊâÄ‰ª• x = 5",
                    "image": ""
                },
                {
                    "question": "Ë®àÁÆóÂúìÂΩ¢Èù¢Á©çÔºåÂçäÂæë = 3 (œÄ ‚âà 3.14)",
                    "answer": "28.26",
                    "difficulty": 3,
                    "explanation": "‰ΩøÁî®ÂÖ¨Âºè A = œÄr¬≤ÔºåA = 3.14 √ó 3¬≤ = 28.26",
                    "image": ""
                }
            ];

            const dataStr = JSON.stringify(sampleData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'sample_math_questions.json';
            link.click();
        }

        // ÈÅäÊà≤Áõ∏ÈóúÂäüËÉΩ
        function startGame() {
            if (questions.length === 0) {
                alert('Ë´ãÂÖàÊ∑ªÂä†È°åÁõÆÊâçËÉΩÈñãÂßãÈÅäÊà≤ÔºÅ');
                return;
            }

            const gameMode = document.getElementById('gameMode').value;
            let gameQuestions = [];

            switch (gameMode) {
                case 'all':
                    gameQuestions = [...questions];
                    break;
                case 'difficulty':
                    const selectedDifficulty = parseInt(document.getElementById('selectedDifficulty').value);
                    gameQuestions = questions.filter(q => q.difficulty === selectedDifficulty);
                    break;
                case 'random':
                    const count = parseInt(document.getElementById('randomQuestionCount').value);
                    gameQuestions = shuffleArray([...questions]).slice(0, Math.min(count, questions.length));
                    break;
            }

            if (gameQuestions.length === 0) {
                alert('Ê≤íÊúâÁ¨¶ÂêàÊ¢ù‰ª∂ÁöÑÈ°åÁõÆÔºÅ');
                return;
            }

            // ÂàùÂßãÂåñÈÅäÊà≤ÁãÄÊÖã
            gameState = {
                currentQuestionIndex: 0,
                correctAnswers: 0,
                gameQuestions: shuffleArray(gameQuestions),
                startTime: Date.now(),
                timerInterval: null,
                isGameActive: true
            };

            // È°ØÁ§∫ÈÅäÊà≤ÁïåÈù¢
            document.getElementById('gameSetup').classList.add('hidden');
            document.getElementById('gamePlay').classList.remove('hidden');
            document.getElementById('gameComplete').classList.add('hidden');

            // Êõ¥Êñ∞ÈÅäÊà≤Áµ±Ë®à
            document.getElementById('totalQuestions').textContent = gameState.gameQuestions.length;
            document.getElementById('correctCount').textContent = '0';

            // ÈñãÂßãË®àÊôÇÂô®
            startTimer();

            // ËºâÂÖ•Á¨¨‰∏ÄÂÄãÈ°åÁõÆ
            loadCurrentQuestion();
        }

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function startTimer() {
            gameState.timerInterval = setInterval(() => {
                if (gameState.isGameActive) {
                    const elapsed = Math.floor((Date.now() - gameState.startTime) / 1000);
                    const minutes = Math.floor(elapsed / 60);
                    const seconds = elapsed % 60;
                    document.getElementById('timer').textContent = 
                        `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
            }, 1000);
        }

        function stopTimer() {
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
                gameState.timerInterval = null;
            }
        }

        function loadCurrentQuestion() {
            const question = gameState.gameQuestions[gameState.currentQuestionIndex];
            
            // Êõ¥Êñ∞È°åÁõÆÁ∑®Ëôü
            document.getElementById('currentQuestion').textContent = gameState.currentQuestionIndex + 1;
            
            // Êõ¥Êñ∞ÈÄ≤Â∫¶Ê¢ù
            const progress = ((gameState.currentQuestionIndex + 1) / gameState.gameQuestions.length) * 100;
            document.getElementById('gameProgress').style.width = progress + '%';
            
            // È°ØÁ§∫È°åÁõÆ
            document.getElementById('currentQuestionText').textContent = question.question;
            
            // È°ØÁ§∫ÂúñÁâáÔºàÂ¶ÇÊûúÊúâÔºâ
            const imageElement = document.getElementById('currentQuestionImage');
            if (question.image) {
                imageElement.src = question.image;
                imageElement.classList.remove('hidden');
            } else {
                imageElement.classList.add('hidden');
            }
            
            // Ê∏ÖÁ©∫Á≠îÊ°àËº∏ÂÖ•Ê°Ü
            document.getElementById('gameAnswer').value = '';
            document.getElementById('gameAnswer').focus();
            
            // Ê∏ÖÁ©∫ÂèçÈ•ã
            document.getElementById('gameFeedback').classList.add('hidden');
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                submitAnswer();
            }
        }

        function submitAnswer() {
            const userAnswer = document.getElementById('gameAnswer').value.trim().toLowerCase();
            const correctAnswer = gameState.gameQuestions[gameState.currentQuestionIndex].answer;
            const feedback = document.getElementById('gameFeedback');
            
            if (!userAnswer) {
                alert('Ë´ãËº∏ÂÖ•Á≠îÊ°àÔºÅ');
                return;
            }

            feedback.classList.remove('hidden');
            
            if (userAnswer === correctAnswer) {
                gameState.correctAnswers++;
                document.getElementById('correctCount').textContent = gameState.correctAnswers;
                feedback.textContent = '‚úÖ Á≠îÂ∞ç‰∫ÜÔºÅ';
                feedback.className = 'feedback correct';
                
                // È°ØÁ§∫Ëß£È°åË™™ÊòéÔºàÂ¶ÇÊûúÊúâÔºâ
                const explanation = gameState.gameQuestions[gameState.currentQuestionIndex].explanation;
                if (explanation) {
                    feedback.textContent += ` Ëß£Á≠îÔºö${explanation}`;
                }
            } else {
                feedback.textContent = `‚ùå Á≠îÈåØ‰∫ÜÔºÅÊ≠£Á¢∫Á≠îÊ°àÊòØÔºö${correctAnswer}`;
                feedback.className = 'feedback incorrect';
                
                // È°ØÁ§∫Ëß£È°åË™™ÊòéÔºàÂ¶ÇÊûúÊúâÔºâ
                const explanation = gameState.gameQuestions[gameState.currentQuestionIndex].explanation;
                if (explanation) {
                    feedback.textContent += ` Ëß£Á≠îÔºö${explanation}`;
                }
            }

            // Âª∂ÈÅ≤ÂæåÈÄ≤ÂÖ•‰∏ã‰∏ÄÈ°å
            setTimeout(() => {
                nextQuestion();
            }, 3000);
        }

        function nextQuestion() {
            if (gameState.currentQuestionIndex < gameState.gameQuestions.length - 1) {
                gameState.currentQuestionIndex++;
                loadCurrentQuestion();
            } else {
                completeGame();
            }
        }

        function skipQuestion() {
            if (confirm('Á¢∫ÂÆöË¶ÅË∑≥ÈÅéÈÄôÂÄãÈ°åÁõÆÂóéÔºü')) {
                nextQuestion();
            }
        }

        function endGame() {
            if (confirm('Á¢∫ÂÆöË¶ÅÁµêÊùüÈÅäÊà≤ÂóéÔºü')) {
                gameState.isGameActive = false;
                completeGame();
            }
        }

        function completeGame() {
            gameState.isGameActive = false;
            stopTimer();
            
            // Ë®àÁÆóÁµ±Ë®àÊï∏Êìö
            const totalQuestions = gameState.currentQuestionIndex + 1;
            const correctAnswers = gameState.correctAnswers;
            const accuracy = Math.round((correctAnswers / totalQuestions) * 100);
            const elapsed = Math.floor((Date.now() - gameState.startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            
            // È°ØÁ§∫ÂÆåÊàêÁï´Èù¢
            document.getElementById('gamePlay').classList.add('hidden');
            document.getElementById('gameComplete').classList.remove('hidden');
            
            // Êõ¥Êñ∞Áµ±Ë®àË≥áË®ä
            document.getElementById('finalStats').innerHTML = `
                <p>‚úÖ Á≠îÂ∞çÈ°åÊï∏: ${correctAnswers} / ${totalQuestions}</p>
                <p>üìä Ê∫ñÁ¢∫Áéá: ${accuracy}%</p>
                <p>‚è±Ô∏è Á∏ΩÊôÇÈñì: ${minutes}ÂàÜ${seconds}Áßí</p>
                <p>üéØ Âπ≥ÂùáÊØèÈ°åÊôÇÈñì: ${Math.round(elapsed / totalQuestions)}Áßí</p>
            `;
        }

        function restartGame() {
            document.getElementById('gameComplete').classList.add('hidden');
            document.getElementById('gameSetup').classList.remove('hidden');
        }

        // Â≠òÊ™îÁÆ°ÁêÜÂäüËÉΩ
        function saveCurrentState() {
            const saveData = {
                timestamp: new Date().toLocaleString(),
                questions: questions,
                gameResults: gameState.isGameActive ? null : {
                    correctAnswers: gameState.correctAnswers,
                    totalQuestions: gameState.currentQuestionIndex + 1,
                    accuracy: Math.round((gameState.correctAnswers / (gameState.currentQuestionIndex + 1)) * 100),
                    timeSpent: Math.floor((Date.now() - gameState.startTime) / 1000)
                }
            };

            const saves = getSaves();
            saves.push(saveData);
            window.gameSaves = JSON.stringify(saves);
            
            loadSaveList();
            alert('ÁãÄÊÖã‰øùÂ≠òÊàêÂäüÔºÅ');
        }

        function getSaves() {
            try {
                return window.gameSaves ? JSON.parse(window.gameSaves) : [];
            } catch (error) {
                return [];
            }
        }

        function loadSaveList() {
            const saves = getSaves();
            const container = document.getElementById('saveList');
            container.innerHTML = '';

            if (saves.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #718096;">Ê≤íÊúâ‰øùÂ≠òÁöÑË®òÈåÑ</p>';
                return;
            }

            saves.forEach((save, index) => {
                const saveDiv = document.createElement('div');
                saveDiv.className = 'question-item';
                saveDiv.innerHTML = `
                    <button class="delete-btn" onclick="deleteSave(${index})">&times;</button>
                    <h4>Â≠òÊ™î ${index + 1}</h4>
                    <p><strong>‰øùÂ≠òÊôÇÈñìÔºö</strong>${save.timestamp}</p>
                    <p><strong>È°åÁõÆÊï∏ÈáèÔºö</strong>${save.questions.length}</p>
                    ${save.gameResults ? `
                        <p><strong>ÈÅäÊà≤ÊàêÁ∏æÔºö</strong>${save.gameResults.correctAnswers}/${save.gameResults.totalQuestions} (${save.gameResults.accuracy}%)</p>
                        <p><strong>ÈÅäÊà≤ÊôÇÈñìÔºö</strong>${Math.floor(save.gameResults.timeSpent / 60)}ÂàÜ${save.gameResults.timeSpent % 60}Áßí</p>
                    ` : ''}
                    <button class="btn" onclick="loadSave(${index})" style="margin-top: 10px;">ËºâÂÖ•Ê≠§Â≠òÊ™î</button>
                `;
                container.appendChild(saveDiv);
            });
        }

        function loadSave(index) {
            const saves = getSaves();
            if (saves[index]) {
                questions = saves[index].questions;
                saveQuestions();
                updateQuestionCount();
                alert('Â≠òÊ™îËºâÂÖ•ÊàêÂäüÔºÅ');
                switchTab('manage');
            }
        }

        function deleteSave(index) {
            if (confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§Ê≠§Â≠òÊ™îÂóéÔºü')) {
                const saves = getSaves();
                saves.splice(index, 1);
                window.gameSaves = JSON.stringify(saves);
                loadSaveList();
            }
        }

        function clearAllSaves() {
            if (confirm('Á¢∫ÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÂ≠òÊ™îÂóéÔºüÊ≠§Êìç‰ΩúÁÑ°Ê≥ïÂæ©ÂéüÔºÅ')) {
                window.gameSaves = JSON.stringify([]);
                loadSaveList();
            }
        }

        function loadGameState() {
            const saves = getSaves();
            if (saves.length === 0) {
                alert('Ê≤íÊúâÂèØËºâÂÖ•ÁöÑÂ≠òÊ™îÔºÅ');
                return;
            }
            
            // ËºâÂÖ•ÊúÄÊñ∞ÁöÑÂ≠òÊ™î
            const latestSave = saves[saves.length - 1];
            questions = latestSave.questions;
            saveQuestions();
            updateQuestionCount();
            alert('ÈÅäÊà≤ÁãÄÊÖãËºâÂÖ•ÊàêÂäüÔºÅ');
        }

        function saveGameResult() {
            if (!gameState.isGameActive && gameState.correctAnswers !== undefined) {
                const resultData = {
                    timestamp: new Date().toLocaleString(),
                    questions: [],
                    gameResults: {
                        correctAnswers: gameState.correctAnswers,
                        totalQuestions: gameState.currentQuestionIndex + 1,
                        accuracy: Math.round((gameState.correctAnswers / (gameState.currentQuestionIndex + 1)) * 100),
                        timeSpent: Math.floor((Date.now() - gameState.startTime) / 1000)
                    }
                };

                const saves = getSaves();
                saves.push(resultData);
                window.gameSaves = JSON.stringify(saves);
                
                alert('ÈÅäÊà≤ÊàêÁ∏æ‰øùÂ≠òÊàêÂäüÔºÅ');
            } else {
                alert('Ê≤íÊúâÂèØ‰øùÂ≠òÁöÑÈÅäÊà≤ÊàêÁ∏æÔºÅ');
            }
        }