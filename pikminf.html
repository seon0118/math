<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>çš®å…‹æ•å‡½æ•¸æ¢éšªéšŠï¼šé›™é‡æŒ‘æˆ°</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --pikmin-red: #e53935;
            --pikmin-yellow: #fdd835;
            --pikmin-blue: #1e88e5;
            --mushroom-purple: #9c27b0;
            --earth-brown: #795548;
            --grass-green: #558b2f;
        }

        body {
            font-family: 'Nunito', Arial, sans-serif;
            background: linear-gradient(to bottom, var(--earth-brown) 20%, var(--grass-green) 100%);
            margin: 0;
            padding: 0;
            color: #333;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            touch-action: none;
        }

        /* HUD */
        .hud {
            display: flex;
            justify-content: space-between;
            width: 95%;
            padding: 10px 0;
            z-index: 10;
        }
        .hud-item {
            background: rgba(255, 255, 255, 0.95);
            padding: 5px 12px;
            border-radius: 20px;
            text-align: center;
            font-weight: 900;
            box-shadow: 0 4px rgba(0,0,0,0.1);
            border: 2px solid var(--grass-green);
            min-width: 70px;
        }
        .hud-item span { display: block; font-size: 18px; color: var(--pikmin-red); }
        
        /* é—œå¡æŒ‡ç¤ºå™¨ */
        .level-badge {
            position: absolute;
            top: 50px;
            background: var(--pikmin-yellow);
            color: #333;
            padding: 5px 15px;
            border-radius: 15px;
            font-weight: 900;
            box-shadow: 0 3px rgba(0,0,0,0.2);
            z-index: 5;
        }

        /* é¡Œç›®å€ */
        .question-box {
            background: #c5e1a5;
            border: 4px solid #fff;
            border-radius: 20px;
            padding: 10px;
            margin-top: 35px; /* ç‚ºäº†é¿é–‹ Level Badge */
            margin-bottom: 5px;
            text-align: center;
            width: 90%;
            font-weight: 900;
            color: #33691e;
            box-shadow: 0 4px rgba(0,0,0,0.1);
            min-height: 50px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .highlight {
            background: #fff;
            padding: 4px 10px;
            border-radius: 10px;
            color: var(--pikmin-blue);
            display: inline-block;
            border: 2px solid #aed581;
            font-size: 18px;
        }

        /* ç•«å¸ƒ */
        .game-area {
            position: relative;
            background: #fff;
            border: 5px solid #fff;
            border-radius: 0 0 25px 25px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            margin-bottom: 5px;
            overflow: hidden;
        }
        canvas {
            background-color: #fbe9e7;
            display: block;
        }

        /* åº•éƒ¨æ§åˆ¶å€ */
        .control-panel {
            flex-grow: 1;
            width: 100%;
            background-color: rgba(255,255,255,0.9);
            padding-top: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            border-top: 6px solid var(--earth-brown);
            border-radius: 30px 30px 0 0;
        }

        /* LEVEL 1: æ•¸å­—éµç›¤ */
        #level1-controls {
            display: none; /* é è¨­éš±è— */
            width: 100%;
            flex-direction: column;
            align-items: center;
        }
        #displayInput {
            width: 180px;
            height: 45px;
            background: #fff;
            color: var(--pikmin-red);
            font-size: 24px;
            font-weight: 900;
            border: 3px solid var(--pikmin-yellow);
            border-radius: 25px;
            margin-bottom: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .keypad {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            width: 92%;
            max-width: 400px;
        }
        .key {
            background: #fff;
            border: none;
            box-shadow: 0 4px #cfd8dc;
            height: 50px;
            font-size: 20px;
            font-weight: 900;
            border-radius: 50%;
            cursor: pointer;
            color: #546e7a;
        }
        .key:active { transform: translateY(2px); box-shadow: 0 1px #cfd8dc; }
        .key-enter { grid-column: span 2; border-radius: 30px; background: var(--pikmin-red); color: white; box-shadow: 0 4px #c62828;}
        .key-enter:active { box-shadow: 0 2px #c62828; }
        .key-del { background: #546e7a; color: white; }
        .key-minus { background: var(--pikmin-blue); color: white; }

        /* LEVEL 2: è˜‘è‡æˆ°é¬¥é¸é … */
        #level2-controls {
            display: none; /* é è¨­éš±è— */
            width: 100%;
            flex-direction: column;
            align-items: center;
            padding-top: 20px;
        }
        .option-btn {
            width: 90%;
            max-width: 350px;
            margin-bottom: 15px;
            padding: 15px;
            font-size: 20px;
            font-weight: 900;
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 5px rgba(0,0,0,0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.1s;
        }
        .option-btn:active { transform: scale(0.98); }
        .opt-red { background-color: var(--pikmin-red); }
        .opt-yellow { background-color: var(--pikmin-yellow); color: #333; }
        .opt-blue { background-color: var(--pikmin-blue); }

        /* é®ç½© */
        #overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(85, 139, 47, 0.98);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            text-align: center;
            color: white;
        }
        .btn-start {
            margin-top: 20px;
            padding: 15px 40px;
            font-size: 22px;
            font-weight: 900;
            background: var(--pikmin-yellow);
            color: #333;
            border: 4px solid #fff;
            border-radius: 40px;
            cursor: pointer;
        }

        /* è¨Šæ¯æç¤º */
        #message {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 20px;
            font-weight: 900;
            color: #fff;
            padding: 10px 20px;
            border-radius: 15px;
            display: none;
            z-index: 50;
            white-space: nowrap;
        }
    </style>
</head>
<body>

    <div class="hud">
        <div class="hud-item score">åˆ†æ•¸<br><span id="scoreDisplay">0</span></div>
        <div class="hud-item">å¤±èª¤<br><span id="strikeDisplay">0</span>/3</div>
        <div class="hud-item">æ™‚é–“<br><span id="timeDisplay">--</span></div>
    </div>

    <div id="levelBadge" class="level-badge">LEVEL 1</div>

    <div class="question-box">
        <div id="qText" style="font-size:14px; margin-bottom:5px; opacity:0.8;"></div>
        <div id="qContent"></div>
    </div>

    <div class="game-area">
        <canvas id="gameCanvas" width="340" height="240"></canvas>
        <div id="message"></div>
    </div>

    <div class="control-panel">
        
        <div id="level1-controls">
            <div id="displayInput">?</div>
            <div class="keypad">
                <button class="key" onclick="inputNum('1')">1</button>
                <button class="key" onclick="inputNum('2')">2</button>
                <button class="key" onclick="inputNum('3')">3</button>
                <button class="key key-minus" onclick="inputNum('-')">-</button>
                <button class="key" onclick="inputNum('4')">4</button>
                <button class="key" onclick="inputNum('5')">5</button>
                <button class="key" onclick="inputNum('6')">6</button>
                <button class="key key-del" onclick="inputNum('C')">â†</button>
                <button class="key" onclick="inputNum('7')">7</button>
                <button class="key" onclick="inputNum('8')">8</button>
                <button class="key" onclick="inputNum('9')">9</button>
                <button class="key" onclick="inputNum('0')">0</button>
                
                <button class="key key-enter" id="l1-submit" onclick="submitLevel1()">æŠ•æ“²!</button>
                <button class="key key-enter" id="l1-next" onclick="nextLevel1Question()" style="display:none; background:var(--pikmin-blue);">ä¸‹ä¸€é¡Œ</button>
            </div>
        </div>

        <div id="level2-controls">
            <div style="font-size:16px; margin-bottom:10px; color:#558b2f; font-weight:bold;">æ´¾å‡ºå“ªä¸€éšŠçš®å…‹æ•å»æ‰“è˜‘è‡ï¼Ÿ</div>
            <button class="option-btn opt-red" onclick="checkLevel2(0)">
                <span class="opt-icon">ğŸ”´</span> <span id="opt-0-text">y = 2x</span>
            </button>
            <button class="option-btn opt-yellow" onclick="checkLevel2(1)">
                <span class="opt-icon">ğŸŸ¡</span> <span id="opt-1-text">y = x + 1</span>
            </button>
            <button class="option-btn opt-blue" onclick="checkLevel2(2)">
                <span class="opt-icon">ğŸ”µ</span> <span id="opt-2-text">y = -x</span>
            </button>
            <button class="option-btn" id="l2-next" onclick="nextLevel2Question()" style="display:none; background:#558b2f; justify-content:center;">å°‹æ‰¾ä¸‹å€‹è˜‘è‡ â–¶</button>
        </div>

    </div>

    <div id="overlay">
        <h1 id="ov-title" style="color:#fdd835; margin-bottom:10px;">çš®å…‹æ•<br>å‡½æ•¸æ¢éšªéšŠ</h1>
        <p id="ov-desc" style="font-size:16px;">æº–å‚™å¥½ä½ çš„æ•¸å­¸è…¦è¢‹äº†å—ï¼Ÿ</p>
        <button id="ov-btn" class="btn-start" onclick="initLevel1()">é–‹å§‹ç¬¬ä¸€é—œ</button>
    </div>

<script>
    // --- æ ¸å¿ƒè®Šæ•¸ ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const msgDiv = document.getElementById('message');
    
    // UI å…ƒç´ 
    const overlay = document.getElementById('overlay');
    const ovTitle = document.getElementById('ov-title');
    const ovDesc = document.getElementById('ov-desc');
    const ovBtn = document.getElementById('ov-btn');
    const levelBadge = document.getElementById('levelBadge');
    
    // éŠæˆ²ç‹€æ…‹
    let currentLevel = 1; 
    let score = 0;
    let strikes = 0;
    let timeLeft = 0;
    let timerInterval = null;
    let isGameActive = false;
    
    // ç¹ªåœ–åƒæ•¸
    let scale = 15;
    let centerX = 170;
    let centerY = 120;

    // Level 1 é¡Œç›®æ•¸æ“š
    let l1_slope, l1_intercept, l1_targetX, l1_correctY, l1_input = "";

    // Level 2 é¡Œç›®æ•¸æ“š
    let l2_slope, l2_intercept;
    let l2_options = []; // å­˜æ”¾3å€‹æ–¹ç¨‹å¼å­—ä¸²
    let l2_correctIndex = 0;

    // --- é€šç”¨åŠŸèƒ½ ---

    function showMsg(text, color) {
        msgDiv.innerText = text;
        msgDiv.style.backgroundColor = color;
        msgDiv.style.display = 'block';
    }

    function updateHUD() {
        document.getElementById('scoreDisplay').innerText = score;
        document.getElementById('strikeDisplay').innerText = strikes;
        document.getElementById('timeDisplay').innerText = timeLeft;
    }

    function startTimer(seconds, onFinish) {
        if (timerInterval) clearInterval(timerInterval);
        timeLeft = seconds;
        updateHUD();
        timerInterval = setInterval(() => {
            if(!isGameActive) return;
            timeLeft--;
            updateHUD();
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                onFinish();
            }
        }, 1000);
    }

    function gameOver(reason) {
        isGameActive = false;
        clearInterval(timerInterval);
        overlay.style.display = 'flex';
        ovTitle.innerText = "ä»»å‹™çµæŸ";
        ovDesc.innerText = reason + "\næœ€çµ‚åˆ†æ•¸: " + score;
        ovBtn.innerText = "é‡æ–°æŒ‘æˆ°";
        ovBtn.onclick = initLevel1;
    }

    // --- ç¬¬ä¸€é—œï¼šç™¼å°„å™¨ (120ç§’) ---

    function initLevel1() {
        currentLevel = 1;
        score = 0;
        strikes = 0;
        
        // UI åˆ‡æ›
        overlay.style.display = 'none';
        levelBadge.innerText = "LEVEL 1: ç„æº–å°„æ“Š";
        levelBadge.style.backgroundColor = "#fdd835"; // é»ƒè‰²
        document.getElementById('level1-controls').style.display = 'flex';
        document.getElementById('level2-controls').style.display = 'none';
        
        isGameActive = true;
        startTimer(120, finishLevel1); // 2åˆ†é˜
        nextLevel1Question();
    }

    function finishLevel1() {
        isGameActive = false;
        clearInterval(timerInterval);
        // çµç®—ç•«é¢
        overlay.style.display = 'flex';
        ovTitle.innerText = "ç¬¬ä¸€é—œ é€šé!";
        ovDesc.innerText = "å¾—åˆ†: " + score + "\næº–å‚™å¥½æ‰“è˜‘è‡äº†å—ï¼Ÿ";
        ovBtn.innerText = "é€²å…¥ç¬¬äºŒé—œ";
        ovBtn.onclick = initLevel2;
    }

    function nextLevel1Question() {
        isGameActive = true;
        l1_input = "";
        document.getElementById('displayInput').innerText = "?";
        msgDiv.style.display = 'none';
        
        // æŒ‰éˆ•é‡ç½®
        document.getElementById('l1-submit').style.display = 'grid'; // grid for span 2
        document.getElementById('l1-next').style.display = 'none';

        // å‡ºé¡Œ
        l1_slope = Math.floor(Math.random() * 5) - 2; 
        if(l1_slope===0) l1_slope=1;
        l1_intercept = Math.floor(Math.random() * 9) - 4;
        l1_targetX = Math.floor(Math.random() * 9) - 4;
        l1_correctY = l1_slope * l1_targetX + l1_intercept;

        // é¡¯ç¤º
        document.getElementById('qText').innerText = "éšŠé•·æŒ‡ä»¤ (ç®—å‡º y å€¼)";
        let sign = l1_intercept >= 0 ? "+ " : "- ";
        let eq = `y = ${l1_slope}x ${sign} ${Math.abs(l1_intercept)}`;
        if(l1_slope===0) eq=`y=${l1_intercept}`;
        else if(l1_slope===1) eq=`y=x ${sign} ${Math.abs(l1_intercept)}`;
        else if(l1_slope===-1) eq=`y=-x ${sign} ${Math.abs(l1_intercept)}`;
        else if(l1_intercept===0) eq=`y=${l1_slope}x`;

        document.getElementById('qContent').innerHTML = 
            `<span class="highlight">${eq}</span> ç›®æ¨™ <span class="highlight">x=${l1_targetX}</span>`;

        drawLevel1Scene(null);
    }

    function inputNum(key) {
        if(!isGameActive || currentLevel !== 1) return;
        if (key === 'C') l1_input = l1_input.slice(0, -1);
        else if (key === '-') {
            if (l1_input === "") l1_input = "-";
            else if (l1_input === "-") l1_input = "";
        } else {
            if (l1_input.length < 4) l1_input += key;
        }
        document.getElementById('displayInput').innerText = l1_input === "" ? "?" : l1_input;
    }

    function submitLevel1() {
        if (l1_input === "" || l1_input === "-") return;
        isGameActive = false; // æš«åœæ“ä½œ
        let val = parseInt(l1_input);
        
        drawLevel1Scene(val);

        if (val === l1_correctY) {
            score += 100;
            showMsg("å‘½ä¸­! (+100)", "#558b2f");
        } else {
            strikes++;
            showMsg("å¤±èª¤!", "#c62828");
        }
        updateHUD();

        if (strikes >= 3) {
            setTimeout(() => gameOver("çš®å…‹æ•å…¨æ•¸é™£äº¡..."), 1000);
        } else {
            document.getElementById('l1-submit').style.display = 'none';
            document.getElementById('l1-next').style.display = 'grid';
        }
    }

    function drawLevel1Scene(userY) {
        ctx.fillStyle = "#fbe9e7"; ctx.fillRect(0,0,340,240);
        drawGridAndAxes();

        // ç›®æ¨™ç·š
        let px = centerX + l1_targetX * scale;
        ctx.strokeStyle = "rgba(229, 57, 53, 0.5)";
        ctx.setLineDash([5,5]); ctx.beginPath(); ctx.moveTo(px,0); ctx.lineTo(px,240); ctx.stroke(); ctx.setLineDash([]);

        // æ•µäºº (å°åœ“é»)
        ctx.fillStyle = "#d32f2f"; ctx.beginPath(); ctx.arc(px, centerY, 8, 0, Math.PI*2); ctx.fill();

        if (userY !== null) {
            let py = centerY - userY * scale;
            let isCorrect = (userY === l1_correctY);
            
            // ç•«ç·š
            ctx.lineWidth = 3;
            ctx.strokeStyle = isCorrect ? "#558b2f" : "#90a4ae";
            ctx.beginPath();
            let x1 = -20; let y1 = l1_slope*x1 + l1_intercept;
            let x2 = 20; let y2 = l1_slope*x2 + l1_intercept;
            if(isCorrect) {
                ctx.moveTo(centerX+x1*scale, centerY-y1*scale);
                ctx.lineTo(centerX+x2*scale, centerY-y2*scale);
                ctx.stroke();
                // ç•«çš®å…‹æ•
                drawPikminHead(px, py, "#e53935");
            } else {
                ctx.moveTo(0, py); ctx.lineTo(px, py); ctx.stroke(); // éŒ¯èª¤è»Œè·¡
                drawPikminHead(px, py, "#1e88e5"); // è—è‰²å¤±æ•—
                // æ­£ç¢ºæç¤º
                ctx.strokeStyle="#76ff03"; ctx.lineWidth=2; ctx.beginPath(); ctx.arc(px, centerY-l1_correctY*scale, 10, 0, Math.PI*2); ctx.stroke();
            }
        }
    }

    // --- ç¬¬äºŒé—œï¼šè˜‘è‡æˆ°é¬¥ (180ç§’) ---

    function initLevel2() {
        currentLevel = 2;
        strikes = 0; // é‡ç½®å¤±èª¤æ¬¡æ•¸ (æˆ–è€…å¯ä»¥é¸æ“‡ç¹¼æ‰¿)
        
        overlay.style.display = 'none';
        levelBadge.innerText = "LEVEL 2: è˜‘è‡è¨ä¼æˆ°";
        levelBadge.style.backgroundColor = "#9c27b0"; // ç´«è‰²
        levelBadge.style.color = "#fff";
        
        document.getElementById('level1-controls').style.display = 'none';
        document.getElementById('level2-controls').style.display = 'flex';

        isGameActive = true;
        startTimer(180, finishLevel2); // 3åˆ†é˜
        nextLevel2Question();
    }

    function finishLevel2() {
        isGameActive = false;
        clearInterval(timerInterval);
        gameOver("æ­å–œé€šé—œï¼"); // ä½¿ç”¨ Game Over ç•«é¢ä½†é¡¯ç¤ºå‹åˆ©
        ovTitle.innerText = "å…¨æ•¸é€šé—œ!";
        ovDesc.innerText = "ä½ æ˜¯æ•¸å­¸å¤§å¸«ï¼\næœ€çµ‚åˆ†æ•¸: " + score;
        ovBtn.innerText = "é‡æ–°é–‹å§‹";
    }

    function nextLevel2Question() {
        isGameActive = true;
        msgDiv.style.display = 'none';
        
        // é¡¯ç¤ºé¸é …æŒ‰éˆ•ï¼Œéš±è— Next æŒ‰éˆ•
        let btns = document.querySelectorAll('.option-btn');
        btns.forEach(b => { b.style.display = 'flex'; b.disabled = false; b.style.opacity = "1"; });
        document.getElementById('l2-next').style.display = 'none';

        // 1. ç”Ÿæˆæ­£ç¢ºç·šæ®µ (é™åˆ¶åœ¨ç•«é¢å…§æ¯”è¼ƒå¥½è§€å¯Ÿçš„æ–œç‡)
        l2_slope = Math.floor(Math.random() * 5) - 2; // -2, -1, 0, 1, 2
        l2_intercept = Math.floor(Math.random() * 7) - 3; // -3 ~ 3

        // 2. ç”Ÿæˆé¸é …
        let correctEq = formatEq(l2_slope, l2_intercept);
        let wrong1, wrong2;
        
        // ç°¡å–®çš„éŒ¯èª¤é¸é …ç”Ÿæˆé‚è¼¯
        do {
            let fakeM = Math.floor(Math.random() * 5) - 2;
            let fakeB = Math.floor(Math.random() * 7) - 3;
            wrong1 = formatEq(fakeM, fakeB);
        } while (wrong1 === correctEq);

        do {
            let fakeM = Math.floor(Math.random() * 5) - 2;
            let fakeB = Math.floor(Math.random() * 7) - 3;
            wrong2 = formatEq(fakeM, fakeB);
        } while (wrong2 === correctEq || wrong2 === wrong1);

        // 3. éš¨æ©Ÿæ’åˆ—
        l2_options = [correctEq, wrong1, wrong2];
        l2_correctIndex = Math.floor(Math.random() * 3);
        // äº¤æ›
        [l2_options[0], l2_options[l2_correctIndex]] = [l2_options[l2_correctIndex], l2_options[0]];

        // 4. æ›´æ–° UI
        document.getElementById('qText').innerText = "è§€å¯Ÿåœ–å½¢";
        document.getElementById('qContent').innerHTML = "æ‰¾å‡ºå°æ‡‰çš„æ–¹ç¨‹å¼ä¾†æ”»æ“Šè˜‘è‡ï¼";
        
        document.getElementById('opt-0-text').innerText = l2_options[0];
        document.getElementById('opt-1-text').innerText = l2_options[1];
        document.getElementById('opt-2-text').innerText = l2_options[2];

        drawLevel2Scene(false);
    }

    function formatEq(m, b) {
        let sign = b >= 0 ? "+ " : "- ";
        let txt = `y = ${m}x ${sign} ${Math.abs(b)}`;
        if(m===0) txt = `y = ${b}`;
        else if(m===1) txt = `y = x ${sign} ${Math.abs(b)}`;
        else if(m===-1) txt = `y = -x ${sign} ${Math.abs(b)}`;
        else if(b===0) txt = `y = ${m}x`;
        return txt;
    }

    function checkLevel2(idx) {
        if(!isGameActive) return;
        isGameActive = false;
        
        let isCorrect = (idx === l2_correctIndex);
        
        drawLevel2Scene(true, isCorrect); // é€™è£¡ true ä»£è¡¨é¡¯ç¤ºçµæœå‹•ç•«

        if(isCorrect) {
            score += 150; // ç¬¬äºŒé—œåˆ†æ•¸è¼ƒé«˜
            showMsg("è˜‘è‡æ“Šç ´! (+150)", "#9c27b0");
        } else {
            strikes++;
            showMsg("é¸éŒ¯éšŠä¼äº†...", "#c62828");
        }
        updateHUD();

        // é–å®šæŒ‰éˆ•
        let btns = document.querySelectorAll('.option-btn');
        btns.forEach((b, i) => { 
            if(i !== 3) { // ä¸åŒ…å« next æŒ‰éˆ•
                b.disabled = true; 
                if(i !== idx) b.style.opacity = "0.3"; // æ·¡åŒ–æ²’é¸çš„
            }
        });

        if (strikes >= 3) {
            setTimeout(() => gameOver("ä»»å‹™å¤±æ•—..."), 1000);
        } else {
            document.getElementById('l2-next').style.display = 'flex';
        }
    }

    function drawLevel2Scene(showResult, isCorrect) {
        ctx.fillStyle = "#f3e5f5"; // æ·¡ç´«è‰²èƒŒæ™¯
        ctx.fillRect(0,0,340,240);
        drawGridAndAxes();

        // 1. ç•«å‡ºæ­£ç¢ºçš„å‡½æ•¸ç·š (ä½œç‚ºé¡Œç›®)
        ctx.lineWidth = 4;
        ctx.strokeStyle = "#558b2f"; // ç·šæ¢æ˜¯é¡Œç›®ï¼Œçµ¦æ˜é¡¯é¡è‰²
        ctx.beginPath();
        let x1 = -20; let y1 = l2_slope*x1 + l2_intercept;
        let x2 = 20; let y2 = l2_slope*x2 + l2_intercept;
        ctx.moveTo(centerX+x1*scale, centerY-y1*scale);
        ctx.lineTo(centerX+x2*scale, centerY-y2*scale);
        ctx.stroke();

        // 2. ç•«è˜‘è‡ (åœ¨ç·šçš„æŸå€‹ä½ç½®)
        let mushX = 4; 
        let mushY = l2_slope * mushX + l2_intercept;
        // ç¢ºä¿è˜‘è‡åœ¨ç•«é¢å…§ï¼Œå¦‚æœåœ¨å¤–é¢å°±æ›å€‹ä½ç½®
        if(Math.abs(mushY) > 7) { mushX = -4; mushY = l2_slope * mushX + l2_intercept; }
        
        let px = centerX + mushX * scale;
        let py = centerY - mushY * scale;

        drawMushroom(px, py, showResult && isCorrect); // å¦‚æœç­”å°ï¼Œè˜‘è‡æœƒå—å‚·?

        if(showResult) {
            if(isCorrect) {
                // ç•«ä¸€ç¾¤çš®å…‹æ•æ”»æ“Š
                drawPikminHead(px-15, py+10, "#e53935");
                drawPikminHead(px+15, py+10, "#fdd835");
            } else {
                // ç•«å•è™Ÿ
                ctx.fillStyle = "#333";
                ctx.font = "30px Arial";
                ctx.fillText("?", px, py-20);
            }
        }
    }

    function drawMushroom(x, y, isDead) {
        ctx.save();
        ctx.translate(x, y);
        if(isDead) ctx.globalAlpha = 0.5; // åŠé€æ˜ä»£è¡¨è¢«æ‰“æ•—

        // æ¢—
        ctx.fillStyle = "#f0f0f0";
        ctx.fillRect(-6, 0, 12, 20);
        
        // å‚˜è“‹
        ctx.fillStyle = "#9c27b0";
        ctx.beginPath();
        ctx.arc(0, 0, 20, Math.PI, 0); // åŠåœ“
        ctx.fill();
        
        // æ–‘é»
        ctx.fillStyle = "#e1bee7";
        ctx.beginPath(); ctx.arc(-10, -8, 4, 0, Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.arc(8, -5, 3, 0, Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.arc(0, -12, 5, 0, Math.PI*2); ctx.fill();

        ctx.restore();
    }

    // --- å…±ç”¨ç¹ªåœ–å°å·¥å…· ---

    function drawGridAndAxes() {
        ctx.strokeStyle = "rgba(0,0,0,0.1)"; ctx.lineWidth=1;
        for(let x=0; x<=340; x+=scale) { ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,240); ctx.stroke(); }
        for(let y=0; y<=240; y+=scale) { ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(340,y); ctx.stroke(); }
        ctx.strokeStyle = "#5d4037"; ctx.lineWidth=2;
        ctx.beginPath(); ctx.moveTo(0,centerY); ctx.lineTo(340,centerY); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(centerX,0); ctx.lineTo(centerX,240); ctx.stroke();
    }

    function drawPikminHead(x, y, color) {
        ctx.fillStyle = color;
        ctx.beginPath(); ctx.arc(x, y, 6, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = "#fff";
        ctx.beginPath(); ctx.arc(x-2, y-1, 2, 0, Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.arc(x+2, y-1, 2, 0, Math.PI*2); ctx.fill();
        // è‘‰å­
        ctx.strokeStyle = "#558b2f"; ctx.lineWidth=2;
        ctx.beginPath(); ctx.moveTo(x, y-6); ctx.lineTo(x, y-10); ctx.stroke();
    }

    // åˆå§‹åŒ–é¡¯ç¤ºä¸»é¸å–®
    // ä¸åšä»»ä½•äº‹ï¼Œç­‰å¾…ä½¿ç”¨è€…æŒ‰æŒ‰éˆ•

</script>
</body>
</html>
