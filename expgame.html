<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŒ‡æ•¸å¾‹å°æˆ°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Arial Black', sans-serif;
        }
        .grid-bg {
            background-image: linear-gradient(rgba(255,255,255,0.1) 2px, transparent 2px), 
                              linear-gradient(90deg, rgba(255,255,255,0.1) 2px, transparent 2px);
            background-size: 50px 50px;
        }
        .glow-text {
            text-shadow: 0 0 20px rgba(255,255,255,0.8);
        }
        .glow-cyan {
            box-shadow: 0 0 20px rgba(0,255,255,0.5);
        }
        .glow-orange {
            box-shadow: 0 0 20px rgba(255,100,0,0.5);
        }
        .glow-yellow {
            box-shadow: 0 0 40px rgba(255,215,0,0.8);
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-25px); }
        }
        .animate-bounce {
            animation: bounce 1s infinite;
        }
    </style>
</head>
<body class="bg-black">
    <!-- éŸ³è¨Š -->
    <audio id="bgMusic" loop>
        <source src="https://drive.google.com/uc?export=download&id=18QW0K3LaTPdrLHXsF_Xmq3Wj9X6bl3AE" type="audio/mpeg">
    </audio>

    <!-- é ‚éƒ¨æ§åˆ¶åˆ— -->
    <div id="topBar" class="bg-gradient-to-r from-purple-900 via-gray-900 to-red-900 py-5 px-8 flex justify-between items-center border-b-4 border-yellow-400 shadow-2xl">
        <button id="muteBtn" class="p-3 bg-gray-800 hover:bg-gray-700 rounded-full transition-all transform hover:scale-110 border-2 border-gray-600">
            <span id="volumeIcon" class="text-2xl">ğŸ”Š</span>
        </button>
        
        <div class="flex items-center bg-black bg-opacity-60 px-8 py-3 rounded-full border-4 border-yellow-400 shadow-2xl">
            <span class="text-4xl mr-3">âš¡</span>
            <span id="timer" class="text-5xl font-black text-white glow-text">1:00</span>
        </div>
        
        <div class="w-16"></div>
    </div>

    <!-- éŠæˆ²å€åŸŸ -->
    <div id="gameArea" class="flex" style="height: calc(100vh - 90px);">
        <!-- é–‹å§‹ç•«é¢ -->
        <div id="startScreen" class="flex-1 flex flex-col items-center justify-center bg-gradient-to-br from-purple-900 via-black to-red-900 text-white relative overflow-hidden grid-bg">
            <div class="text-9xl mb-8 animate-pulse" style="text-shadow: 0 0 30px rgba(255,215,0,0.8);">ğŸ†</div>
            <h1 class="text-7xl font-black mb-6 tracking-wider glow-text">æŒ‡æ•¸å¾‹å°æˆ°</h1>
            <p class="text-3xl mb-3 font-bold text-cyan-300">é›™äººå°æˆ° â€¢ 60ç§’æŒ‘æˆ°</p>
            <p class="text-2xl mb-10 font-bold text-yellow-300">âš ï¸ åŸºæœ¬å®Œæˆ10é¡Œï¼Œæœªå®Œæˆæ¯é¡Œæ‰£5åˆ†</p>
            <button id="startBtn" class="bg-gradient-to-r from-yellow-400 to-orange-500 text-black px-16 py-8 rounded-full text-4xl font-black hover:from-yellow-300 hover:to-orange-400 transition-all transform hover:scale-110 shadow-2xl border-4 border-yellow-300 animate-pulse glow-yellow">
                é–‹å§‹éŠæˆ²
            </button>
        </div>

        <!-- ç©å®¶1å€åŸŸ -->
        <div id="player1Area" class="flex-1 hidden flex-col items-center justify-center p-8 relative overflow-hidden bg-gradient-to-br from-cyan-900 via-blue-900 to-purple-900">
            <div class="absolute inset-0 opacity-10 grid-bg"></div>
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-cyan-400 to-blue-500 shadow-lg"></div>
            
            <div class="relative z-10 text-center">
                <div class="text-3xl font-black mb-4 tracking-wider text-cyan-400" style="text-shadow: 0 0 10px rgba(0,0,0,0.5);">ç©å®¶ 1</div>
                <div id="p1Score" class="text-8xl font-black mb-4 text-white glow-text">0</div>
                <div id="p1Combo" class="text-3xl font-black mb-3 text-gray-300" style="display: none;">
                    <span>ğŸ”¥</span> <span id="p1ComboNum">0</span>é€£æ“Š <span>ğŸ”¥</span>
                </div>
                <div class="flex gap-6 mb-4 text-lg font-bold text-gray-300">
                    <div class="bg-black bg-opacity-50 px-4 py-2 rounded-lg backdrop-blur-sm border border-gray-600">
                        å·²å®Œæˆ: <span id="p1Completed" class="text-yellow-300">0</span>/10
                    </div>
                    <div class="bg-black bg-opacity-50 px-4 py-2 rounded-lg backdrop-blur-sm border border-gray-600">
                        ç­”éŒ¯: <span id="p1Wrong" class="text-red-400">0</span>
                    </div>
                </div>
                <div id="p1Timer" class="text-6xl font-black mb-6 text-white">â±ï¸ 10</div>
                <div id="p1Question" class="mb-8 p-6 bg-black bg-opacity-60 rounded-2xl backdrop-blur-md border-2 border-gray-600 shadow-2xl">
                    <span class="text-3xl font-bold text-white"></span>
                </div>
                <div id="p1Options" class="grid grid-cols-2 gap-5 w-full max-w-lg"></div>
                <div id="p1Feedback" class="mt-8 text-4xl font-black px-8 py-4 rounded-xl shadow-2xl" style="display: none;"></div>
            </div>
        </div>

        <!-- åˆ†éš”ç·š -->
        <div id="divider" class="w-1 bg-gradient-to-b from-yellow-400 via-white to-yellow-400 hidden" style="box-shadow: 0 0 20px rgba(255,215,0,0.8);"></div>

        <!-- ç©å®¶2å€åŸŸ -->
        <div id="player2Area" class="flex-1 hidden flex-col items-center justify-center p-8 relative overflow-hidden bg-gradient-to-br from-red-900 via-orange-900 to-yellow-900">
            <div class="absolute inset-0 opacity-10 grid-bg"></div>
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-red-500 to-orange-500 shadow-lg"></div>
            
            <div class="relative z-10 text-center">
                <div class="text-3xl font-black mb-4 tracking-wider text-orange-400" style="text-shadow: 0 0 10px rgba(0,0,0,0.5);">ç©å®¶ 2</div>
                <div id="p2Score" class="text-8xl font-black mb-4 text-white glow-text">0</div>
                <div id="p2Combo" class="text-3xl font-black mb-3 text-gray-300" style="display: none;">
                    <span>ğŸ”¥</span> <span id="p2ComboNum">0</span>é€£æ“Š <span>ğŸ”¥</span>
                </div>
                <div class="flex gap-6 mb-4 text-lg font-bold text-gray-300">
                    <div class="bg-black bg-opacity-50 px-4 py-2 rounded-lg backdrop-blur-sm border border-gray-600">
                        å·²å®Œæˆ: <span id="p2Completed" class="text-yellow-300">0</span>/10
                    </div>
                    <div class="bg-black bg-opacity-50 px-4 py-2 rounded-lg backdrop-blur-sm border border-gray-600">
                        ç­”éŒ¯: <span id="p2Wrong" class="text-red-400">0</span>
                    </div>
                </div>
                <div id="p2Timer" class="text-6xl font-black mb-6 text-white">â±ï¸ 10</div>
                <div id="p2Question" class="mb-8 p-6 bg-black bg-opacity-60 rounded-2xl backdrop-blur-md border-2 border-gray-600 shadow-2xl">
                    <span class="text-3xl font-bold text-white"></span>
                </div>
                <div id="p2Options" class="grid grid-cols-2 gap-5 w-full max-w-lg"></div>
                <div id="p2Feedback" class="mt-8 text-4xl font-black px-8 py-4 rounded-xl shadow-2xl" style="display: none;"></div>
            </div>
        </div>

        <!-- çµæŸç•«é¢ -->
        <div id="endScreen" class="flex-1 hidden flex-col items-center justify-center bg-gradient-to-br from-yellow-600 via-orange-600 to-red-600 text-white relative overflow-hidden grid-bg">
            <div class="text-9xl mb-8 animate-bounce" style="text-shadow: 0 0 40px rgba(255,215,0,1);">ğŸ†</div>
            <h1 class="text-7xl font-black mb-12 tracking-wider glow-text">éŠæˆ²çµæŸ!</h1>
            
            <div class="flex gap-20 mb-12">
                <div class="text-center bg-black bg-opacity-40 p-8 rounded-3xl backdrop-blur-md border-4 border-cyan-400 shadow-2xl">
                    <div class="text-3xl mb-3 font-black text-cyan-300">ç©å®¶ 1</div>
                    <div id="p1FinalScore" class="text-9xl font-black" style="text-shadow: 0 0 20px rgba(0,255,255,0.8);">0</div>
                    <div class="text-xl mt-4 font-bold">å·²å®Œæˆ: <span id="p1FinalCompleted">0</span>/10</div>
                    <div class="text-xl font-bold">ç­”éŒ¯: <span id="p1FinalWrong">0</span></div>
                    <div id="p1Penalty" class="text-lg text-red-300 mt-2 font-bold" style="display: none;">
                        æ‡²ç½°: -<span id="p1PenaltyNum">0</span>
                    </div>
                </div>
                
                <div class="text-8xl font-black self-center glow-text">VS</div>
                
                <div class="text-center bg-black bg-opacity-40 p-8 rounded-3xl backdrop-blur-md border-4 border-orange-400 shadow-2xl">
                    <div class="text-3xl mb-3 font-black text-orange-300">ç©å®¶ 2</div>
                    <div id="p2FinalScore" class="text-9xl font-black" style="text-shadow: 0 0 20px rgba(255,100,0,0.8);">0</div>
                    <div class="text-xl mt-4 font-bold">å·²å®Œæˆ: <span id="p2FinalCompleted">0</span>/10</div>
                    <div class="text-xl font-bold">ç­”éŒ¯: <span id="p2FinalWrong">0</span></div>
                    <div id="p2Penalty" class="text-lg text-red-300 mt-2 font-bold" style="display: none;">
                        æ‡²ç½°: -<span id="p2PenaltyNum">0</span>
                    </div>
                </div>
            </div>

            <div id="winnerText" class="text-6xl font-black mb-12 px-12 py-6 bg-black bg-opacity-50 rounded-3xl backdrop-blur-md border-4 border-yellow-300 shadow-2xl animate-pulse">
                ğŸ‰ ç©å®¶ 1 ç²å‹! ğŸ‰
            </div>

            <button id="restartBtn" class="bg-gradient-to-r from-green-400 to-blue-500 text-white px-16 py-8 rounded-full text-4xl font-black hover:from-green-300 hover:to-blue-400 transition-all transform hover:scale-110 shadow-2xl border-4 border-white" style="box-shadow: 0 0 40px rgba(0,255,200,0.8);">
                å†ç©ä¸€æ¬¡
            </button>
        </div>
    </div>

    <script>
        // éŠæˆ²ç‹€æ…‹
        let gameState = {
            state: 'ready',
            timeLeft: 60,
            isMuted: false,
            player1: { score: 0, wrong: 0, combo: 0, completed: 0, questionTime: 10, question: null },
            player2: { score: 0, wrong: 0, combo: 0, completed: 0, questionTime: 10, question: null }
        };

        let mainTimer, p1Timer, p2Timer;

        // ç”¢ç”Ÿé¡Œç›®
        function generateQuestion() {
            const types = [
                () => {
                    const base = Math.floor(Math.random() * 5) + 2;
                    const m = Math.floor(Math.random() * 5) + 2;
                    const n = Math.floor(Math.random() * 5) + 2;
                    const answer = m + n;
                    const options = [answer, answer + 1, answer - 1, m * n].sort(() => Math.random() - 0.5);
                    return { base, exp1: m, exp2: n, operator: 'Ã—', options, answer };
                },
                () => {
                    const base = Math.floor(Math.random() * 5) + 2;
                    const m = Math.floor(Math.random() * 5) + 5;
                    const n = Math.floor(Math.random() * 3) + 2;
                    const answer = m - n;
                    const options = [answer, answer + 1, answer - 1, m + n].sort(() => Math.random() - 0.5);
                    return { base, exp1: m, exp2: n, operator: 'Ã·', options, answer };
                },
                () => {
                    const base = Math.floor(Math.random() * 4) + 2;
                    const m = Math.floor(Math.random() * 4) + 2;
                    const n = Math.floor(Math.random() * 3) + 2;
                    const answer = m * n;
                    const options = [answer, m + n, answer + 1, answer - 1].sort(() => Math.random() - 0.5);
                    return { base, exp1: m, exp2: n, operator: 'power', options, answer };
                },
                () => {
                    const a = Math.floor(Math.random() * 4) + 2;
                    const b = Math.floor(Math.random() * 4) + 2;
                    const n = Math.floor(Math.random() * 3) + 2;
                    const answer = n;
                    const options = [n, n + 1, n - 1, n * 2].sort(() => Math.random() - 0.5);
                    return { base: a, base2: b, exp1: n, operator: 'product', options, answer };
                }
            ];
            return types[Math.floor(Math.random() * types.length)]();
        }

        // æ¸²æŸ“é¡Œç›®
        function renderQuestion(question, elementId) {
            const el = document.querySelector(`#${elementId} span`);
            let html = '';
            if (question.operator === 'Ã—') {
                html = `${question.base}<sup>${question.exp1}</sup> Ã— ${question.base}<sup>${question.exp2}</sup> = ${question.base}<sup class="text-yellow-300">?</sup>`;
            } else if (question.operator === 'Ã·') {
                html = `${question.base}<sup>${question.exp1}</sup> Ã· ${question.base}<sup>${question.exp2}</sup> = ${question.base}<sup class="text-yellow-300">?</sup>`;
            } else if (question.operator === 'power') {
                html = `(${question.base}<sup>${question.exp1}</sup>)<sup>${question.exp2}</sup> = ${question.base}<sup class="text-yellow-300">?</sup>`;
            } else if (question.operator === 'product') {
                html = `(${question.base} Ã— ${question.base2})<sup>${question.exp1}</sup> = ${question.base}<sup class="text-yellow-300">?</sup> Ã— ${question.base2}<sup>${question.exp1}</sup>`;
            }
            el.innerHTML = html;
        }

        // æ¸²æŸ“é¸é …
        function renderOptions(question, player) {
            const optionsEl = document.getElementById(`p${player}Options`);
            optionsEl.innerHTML = '';
            question.options.forEach(option => {
                const btn = document.createElement('button');
                const colorClass = player === 1 ? 'bg-gradient-to-br from-cyan-500 to-blue-600 hover:from-cyan-400 hover:to-blue-500 border-cyan-300 glow-cyan' : 'bg-gradient-to-br from-red-500 to-orange-600 hover:from-red-400 hover:to-orange-500 border-orange-300 glow-orange';
                btn.className = 'py-8 px-10 text-3xl font-black rounded-xl transition-all transform hover:scale-110 active:scale-95 shadow-2xl border-4 text-white ' + colorClass;
                btn.textContent = option;
                btn.onclick = function() { handleAnswer(player, option); };
                optionsEl.appendChild(btn);
            });
        }

        // è™•ç†ç­”é¡Œ
        function handleAnswer(player, answer) {
            const p = gameState[`player${player}`];
            const isCorrect = answer === p.question.answer;
            
            if (isCorrect) {
                p.combo++;
                const bonusPoints = Math.floor(p.combo / 3);
                const totalPoints = 1 + bonusPoints;
                p.score += totalPoints;
                p.completed++;
                p.questionTime = 10;
                
                let feedback = `âœ“ æ­£ç¢º! +${totalPoints}`;
                if (p.combo >= 3) feedback += ` ğŸ”¥ ${p.combo}é€£æ“Š`;
                showFeedback(player, feedback, true);
                
                setTimeout(() => {
                    p.question = generateQuestion();
                    updatePlayerUI(player);
                    hideFeedback(player);
                }, 500);
            } else {
                p.combo = 0;
                p.score--;
                p.wrong++;
                showFeedback(player, 'âœ— ç­”éŒ¯ -1', false);
                setTimeout(() => hideFeedback(player), 800);
            }
            
            updatePlayerUI(player);
        }

        // è™•ç†è¶…æ™‚
        function handleTimeout(player) {
            const p = gameState[`player${player}`];
            p.combo = 0;
            p.score -= 10;
            p.wrong++;
            p.questionTime = 10;
            p.question = generateQuestion();
            
            showFeedback(player, 'â° è¶…æ™‚! -10', false);
            setTimeout(() => hideFeedback(player), 1000);
            updatePlayerUI(player);
        }

        // é¡¯ç¤ºåé¥‹
        function showFeedback(player, text, isCorrect) {
            const el = document.getElementById(`p${player}Feedback`);
            el.textContent = text;
            el.className = `mt-8 text-4xl font-black px-8 py-4 rounded-xl shadow-2xl ${isCorrect ? 'bg-green-500 text-white' : 'bg-red-500 text-white'} animate-pulse`;
            el.style.display = 'block';
        }

        function hideFeedback(player) {
            document.getElementById(`p${player}Feedback`).style.display = 'none';
        }

        // æ›´æ–°ç©å®¶UI
        function updatePlayerUI(player) {
            const p = gameState[`player${player}`];
            document.getElementById(`p${player}Score`).textContent = p.score;
            document.getElementById(`p${player}Wrong`).textContent = p.wrong;
            document.getElementById(`p${player}Completed`).textContent = p.completed;
            
            const comboEl = document.getElementById(`p${player}Combo`);
            if (p.combo > 0) {
                document.getElementById(`p${player}ComboNum`).textContent = p.combo;
                comboEl.style.display = 'block';
                if (p.combo >= 3) {
                    comboEl.className = 'text-3xl font-black mb-3 text-yellow-300 animate-pulse';
                } else {
                    comboEl.className = 'text-3xl font-black mb-3 text-gray-300';
                }
            } else {
                comboEl.style.display = 'none';
            }
            
            if (p.question) {
                renderQuestion(p.question, `p${player}Question`);
                renderOptions(p.question, player);
            }
        }

        // é–‹å§‹éŠæˆ²
        function startGame() {
            gameState.state = 'playing';
            gameState.timeLeft = 60;
            gameState.player1 = { score: 0, wrong: 0, combo: 0, completed: 0, questionTime: 10, question: generateQuestion() };
            gameState.player2 = { score: 0, wrong: 0, combo: 0, completed: 0, questionTime: 10, question: generateQuestion() };
            
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('endScreen').style.display = 'none';
            document.getElementById('player1Area').classList.remove('hidden');
            document.getElementById('player1Area').classList.add('flex');
            document.getElementById('player2Area').classList.remove('hidden');
            document.getElementById('player2Area').classList.add('flex');
            document.getElementById('divider').classList.remove('hidden');
            
            updatePlayerUI(1);
            updatePlayerUI(2);
            
            const music = document.getElementById('bgMusic');
            music.currentTime = 0;
            music.play().catch(e => console.log('Audio play failed:', e));
            
            // ä¸»è¨ˆæ™‚å™¨
            mainTimer = setInterval(() => {
                gameState.timeLeft--;
                const mins = Math.floor(gameState.timeLeft / 60);
                const secs = gameState.timeLeft % 60;
                document.getElementById('timer').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
                
                if (gameState.timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
            
            // ç©å®¶1è¨ˆæ™‚å™¨
            p1Timer = setInterval(() => {
                gameState.player1.questionTime--;
                const el = document.getElementById('p1Timer');
                el.textContent = `â±ï¸ ${gameState.player1.questionTime}`;
                if (gameState.player1.questionTime <= 3) {
                    el.className = 'text-6xl font-black mb-6 text-red-600 animate-pulse';
                } else {
                    el.className = 'text-6xl font-black mb-6 text-white';
                }
                
                if (gameState.player1.questionTime <= 0) {
                    handleTimeout(1);
                }
            }, 1000);
            
            // ç©å®¶2è¨ˆæ™‚å™¨
            p2Timer = setInterval(() => {
                gameState.player2.questionTime--;
                const el = document.getElementById('p2Timer');
                el.textContent = `â±ï¸ ${gameState.player2.questionTime}`;
                if (gameState.player2.questionTime <= 3) {
                    el.className = 'text-6xl font-black mb-6 text-red-600 animate-pulse';
                } else {
                    el.className = 'text-6xl font-black mb-6 text-white';
                }
                
                if (gameState.player2.questionTime <= 0) {
                    handleTimeout(2);
                }
            }, 1000);
        }

        // çµæŸéŠæˆ²
        function endGame() {
            clearInterval(mainTimer);
            clearInterval(p1Timer);
            clearInterval(p2Timer);
            
            document.getElementById('bgMusic').pause();
            
            const p1Final = gameState.player1.completed >= 10 ? gameState.player1.score : gameState.player1.score - (10 - gameState.player1.completed) * 5;
            const p2Final = gameState.player2.completed >= 10 ? gameState.player2.score : gameState.player2.score - (10 - gameState.player2.completed) * 5;
            
            document.getElementById('p1FinalScore').textContent = p1Final;
            document.getElementById('p2FinalScore').textContent = p2Final;
            document.getElementById('p1FinalCompleted').textContent = gameState.player1.completed;
            document.getElementById('p2FinalCompleted').textContent = gameState.player2.completed;
            document.getElementById('p1FinalWrong').textContent = gameState.player1.wrong;
            document.getElementById('p2FinalWrong').textContent = gameState.player2.wrong;
            
            if (gameState.player1.completed < 10) {
                document.getElementById('p1Penalty').style.display = 'block';
                document.getElementById('p1PenaltyNum').textContent = (10 - gameState.player1.completed) * 5;
            } else {
                document.getElementById('p1Penalty').style.display = 'none';
            }
            
            if (gameState.player2.completed < 10) {
                document.getElementById('p2Penalty').style.display = 'block';
                document.getElementById('p2PenaltyNum').textContent = (10 - gameState.player2.completed) * 5;
            } else {
                document.getElementById('p2Penalty').style.display = 'none';
            }
            
            const winnerEl = document.getElementById('winnerText');
            if (p1Final > p2Final) {
                winnerEl.textContent = 'ğŸ‰ ç©å®¶ 1 ç²å‹! ğŸ‰';
            } else if (p2Final > p1Final) {
                winnerEl.textContent = 'ğŸ‰ ç©å®¶ 2 ç²å‹! ğŸ‰';
            } else {
                winnerEl.textContent = 'ğŸ¤ å¹³æ‰‹! ğŸ¤';
            }
            
            document.getElementById('player1Area').classList.add('hidden');
            document.getElementById('player2Area').classList.add('hidden');
            document.getElementById('divider').classList.add('hidden');
            document.getElementById('endScreen').classList.remove('hidden');
            document.getElementById('endScreen').classList.add('flex');
        }

        // äº‹ä»¶ç›£è½
        document.getElementById('startBtn').addEventListener('click', startGame);
        document.getElementById('restartBtn').addEventListener('click', startGame);
        
        document.getElementById('muteBtn').addEventListener('click', () => {
            gameState.isMuted = !gameState.isMuted;
            document.getElementById('bgMusic').muted = gameState.isMuted;
            document.getElementById('volumeIcon').textContent = gameState.isMuted ? 'ğŸ”‡' : 'ğŸ”Š';
        });
    </script>
</body>
</html>
