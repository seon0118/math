<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å€åˆ¤è€…è¯ç›Ÿ - å°æˆ°ç‰ˆ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Orbitron', monospace;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .background-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: 
                radial-gradient(circle at 20% 20%, rgba(0, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 0, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 60%, rgba(0, 255, 0, 0.05) 0%, transparent 50%);
            animation: pulse 4s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }
        
        .title {
            font-size: 3rem;
            font-weight: 900;
            text-align: center;
            margin: 20px 0;
            background: linear-gradient(45deg, #00ffff, #ff00ff, #ffff00);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradient-shift 2s ease-in-out infinite;
            text-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
        }
        
        @keyframes gradient-shift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .setup-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: rgba(0, 0, 0, 0.8);
            border: 3px solid #ffff00;
            border-radius: 20px;
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
            box-shadow: 0 0 40px rgba(255, 255, 0, 0.4);
        }
        
        .team-setup {
            display: flex;
            gap: 40px;
            margin: 30px 0;
            width: 100%;
            justify-content: center;
        }
        
        .team-input {
            text-align: center;
        }
        
        .team-label {
            font-size: 1.5rem;
            margin-bottom: 15px;
            font-weight: 700;
        }
        
        .team-left .team-label {
            color: #00ffff;
        }
        
        .team-right .team-label {
            color: #ff00ff;
        }
        
        .team-name-input {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #555;
            border-radius: 10px;
            padding: 15px;
            font-size: 1.2rem;
            color: #fff;
            font-family: 'Orbitron', monospace;
            text-align: center;
            width: 200px;
            margin-bottom: 20px;
        }
        
        .team-left .team-name-input:focus {
            border-color: #00ffff;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
            outline: none;
        }
        
        .team-right .team-name-input:focus {
            border-color: #ff00ff;
            box-shadow: 0 0 15px rgba(255, 0, 255, 0.5);
            outline: none;
        }
        
        .start-btn {
            background: linear-gradient(135deg, #00ff00, #00cc00);
            border: none;
            border-radius: 15px;
            padding: 20px 50px;
            font-size: 1.5rem;
            font-weight: 900;
            color: #000;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 30px;
        }
        
        .start-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.8);
        }
        
        .battle-arena {
            display: none;
            height: 100vh;
            flex-direction: column;
        }
        
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.8);
            border-bottom: 3px solid #ffff00;
        }
        
        .game-info {
            text-align: center;
            color: #ffff00;
        }
        
        .timer-display {
            font-size: 3rem;
            font-weight: 900;
            color: #ff0080;
        }
        
        .timer-display.warning {
            animation: blink 0.5s infinite;
        }
        
        .score-breakdown {
            font-size: 0.8rem;
            color: #aaa;
            margin-top: 5px;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        .battle-field {
            display: flex;
            flex: 1;
            gap: 20px;
            padding: 20px;
        }
        
        .team-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 20px;
            padding: 30px;
            position: relative;
        }
        
        .team-left {
            border: 3px solid #00ffff;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
        }
        
        .team-right {
            border: 3px solid #ff00ff;
            box-shadow: 0 0 30px rgba(255, 0, 255, 0.3);
        }
        
        .team-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .team-name {
            font-size: 2rem;
            font-weight: 900;
            margin-bottom: 10px;
        }
        
        .team-left .team-name {
            color: #00ffff;
        }
        
        .team-right .team-name {
            color: #ff00ff;
        }
        
        .team-score {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .question-display {
            text-align: center;
            margin: 30px 0;
        }
        
        .number-display {
            font-size: 3rem;
            font-weight: 900;
            color: #ffff00;
            margin: 20px 0;
            text-shadow: 0 0 20px rgba(255, 255, 0, 0.8);
        }
        
        .question-text {
            font-size: 1.2rem;
            margin: 15px 0;
        }
        
        .expected-count {
            font-size: 1rem;
            color: #00ff00;
            font-weight: 700;
        }
        
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin: 20px 0;
        }
        
        .option {
            background: linear-gradient(135deg, #2a2a2a, #1a1a1a);
            border: 2px solid #555;
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 700;
            color: #fff;
            text-align: center;
        }
        
        .team-left .option:hover {
            border-color: #00ffff;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
        
        .team-right .option:hover {
            border-color: #ff00ff;
            box-shadow: 0 0 10px rgba(255, 0, 255, 0.5);
        }
        
        .team-left .option.selected {
            background: linear-gradient(135deg, #00ffff, #0080ff);
            border-color: #ffffff;
            color: #000;
        }
        
        .team-right .option.selected {
            background: linear-gradient(135deg, #ff00ff, #ff0080);
            border-color: #ffffff;
            color: #000;
        }
        
        .option.none-selected {
            background: linear-gradient(135deg, #ff4444, #cc0000);
            border-color: #ffffff;
            color: #fff;
        }
        
        .submit-btn {
            background: linear-gradient(135deg, #ff0080, #8000ff);
            border: none;
            border-radius: 10px;
            padding: 12px 25px;
            font-size: 1.1rem;
            font-weight: 900;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 20px;
        }
        
        .submit-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 0, 128, 0.6);
        }
        
        .submit-btn:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .vs-divider {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 80px;
            font-size: 3rem;
            font-weight: 900;
            color: #ffff00;
            text-shadow: 0 0 20px rgba(255, 255, 0, 0.8);
        }
        
        .answer-reveal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .answer-content {
            background: rgba(0, 0, 0, 0.9);
            border: 3px solid #ffff00;
            border-radius: 20px;
            padding: 40px;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 0 40px rgba(255, 255, 0, 0.4);
        }
        
        .answer-content h3 {
            color: #ffff00;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2rem;
        }
        
        .team-result {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        
        .team-result.correct {
            border-left: 5px solid #00ff00;
            background: rgba(0, 255, 0, 0.1);
        }
        
        .team-result.incorrect {
            border-left: 5px solid #ff0000;
            background: rgba(255, 0, 0, 0.1);
        }
        
        .method-section {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        .method-text {
            font-size: 0.95rem;
            color: #ccc;
            margin-top: 8px;
            font-family: 'Courier New', monospace;
        }
        
        .continue-btn {
            background: linear-gradient(135deg, #00ffff, #0080ff);
            border: none;
            border-radius: 15px;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: 900;
            color: #000;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 2px;
            display: block;
            margin: 30px auto;
        }
        
        .continue-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.6);
        }
        
        .final-results {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .final-content {
            background: rgba(0, 0, 0, 0.9);
            border: 3px solid #00ff00;
            border-radius: 20px;
            padding: 50px;
            max-width: 900px;
            text-align: center;
            box-shadow: 0 0 40px rgba(0, 255, 0, 0.4);
        }
        
        .winner-announcement {
            font-size: 3rem;
            font-weight: 900;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #00ffff, #ff00ff, #ffff00);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradient-shift 2s ease-in-out infinite;
        }
        
        .final-scores {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
        }
        
        .final-team-score {
            text-align: center;
        }
        
        .final-team-name {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .final-score-value {
            font-size: 2.5rem;
            font-weight: 900;
        }
        
        .restart-btn {
            background: linear-gradient(135deg, #00ff00, #00cc00);
            border: none;
            border-radius: 15px;
            padding: 15px 40px;
            font-size: 1.3rem;
            font-weight: 900;
            color: #000;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 30px;
        }
        
        .restart-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.6);
        }
        
        .waiting-indicator {
            color: #ffff00;
            font-weight: 700;
            text-align: center;
            margin-top: 20px;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse-text {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .game-rules {
            text-align: left;
            margin: 30px 0;
        }
        
        .game-rules h3 {
            color: #00ffff;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .game-rules ul {
            list-style: none;
            padding-left: 0;
        }
        
        .game-rules li {
            margin: 10px 0;
            padding-left: 20px;
            position: relative;
        }
        
        .game-rules li::before {
            content: 'â–¶';
            position: absolute;
            left: 0;
            color: #ff00ff;
        }
    </style>
</head>
<body>
    <div class="background-animation"></div>
    <div class="container">
        <h1 class="title">å€åˆ¤è€…è¯ç›Ÿ - å°æˆ°ç‰ˆ</h1>
        
        <!-- éšŠä¼è¨­å®šç•«é¢ -->
        <div id="setupScreen" class="setup-screen">
            <h2 style="color: #00ffff; margin-bottom: 20px;">æ­¡è¿ä¾†åˆ°å°æˆ°æ¨¡å¼ï¼</h2>
            <div class="game-rules">
                <h3>å°æˆ°è¦å‰‡ï¼š</h3>
                <ul>
                    <li>å…©éšŠåŒæ™‚é€²è¡ŒPKå°æˆ°</li>
                    <li>å…±æœ‰ä¸‰å€‹é—œå¡ï¼Œæ¯é—œå¡6é¡Œ</li>
                    <li>ç¬¬ä¸€é—œï¼š3ä½æ•¸ï¼Œç¬¬äºŒé—œï¼š4ä½æ•¸ï¼Œç¬¬ä¸‰é—œï¼š6ä½æ•¸</li>
                    <li>åˆ¤æ–·æ•¸å­—æ˜¯å¦ç‚º 2ã€3ã€4ã€5ã€9ã€10ã€11 çš„å€æ•¸</li>
                    <li>æ¯é¡Œé™æ™‚20ç§’ï¼Œæ„ˆå¿«ç­”å°å¾—åˆ†æ„ˆé«˜</li>
                    <li>ç­”å°å¾—10åˆ†ï¼Œé€£çºŒç­”å°æœ‰åŠ åˆ†</li>
                    <li>ç¸½åˆ†é«˜çš„éšŠä¼ç²å‹ï¼</li>
                </ul>
            </div>
            
            <div class="team-setup">
                <div class="team-input team-left">
                    <div class="team-label">å·¦éšŠéšŠå</div>
                    <input type="text" class="team-name-input" id="leftTeamName" placeholder="è¼¸å…¥éšŠä¼åç¨±" maxlength="10">
                </div>
                <div class="team-input team-right">
                    <div class="team-label">å³éšŠéšŠå</div>
                    <input type="text" class="team-name-input" id="rightTeamName" placeholder="è¼¸å…¥éšŠä¼åç¨±" maxlength="10">
                </div>
            </div>
            
            <button class="start-btn" onclick="startBattle()">é–‹å§‹å°æˆ°</button>
        </div>

        <!-- å°æˆ°ç•«é¢ -->
        <div id="battleArena" class="battle-arena">
            <div class="game-header">
                <div class="game-info">
                    <div>é—œå¡ <span id="currentLevel">1</span> - é¡Œç›® <span id="currentQuestion">1</span>/6</div>
                </div>
                <div class="timer-display" id="timerDisplay">10</div>
                <div class="game-info">
                    <div>å°æˆ°é€²è¡Œä¸­</div>
                </div>
            </div>
            
            <div class="battle-field">
                <!-- å·¦éšŠå€åŸŸ -->
                <div class="team-area team-left">
                    <div class="team-header">
                        <div class="team-name" id="leftTeamDisplay">å·¦éšŠ</div>
                        <div class="team-score">åˆ†æ•¸: <span id="leftScore">0</span></div>
                    </div>
                    
                    <div class="question-display">
                        <div class="number-display" id="leftNumber">123</div>
                        <div class="question-text">è«‹é¸æ“‡é€™å€‹æ•¸å­—æ˜¯ä»¥ä¸‹å“ªäº›æ•¸çš„å€æ•¸ï¼š</div>
                        <div class="expected-count" id="leftExpectedCount">è«‹é¸æ“‡æ­£ç¢ºçš„é¸é …æ•¸é‡</div>
                    </div>
                    
                    <div class="options-grid">
                        <div class="option" data-team="left" data-value="2" onclick="toggleTeamOption('left', this)">2</div>
                        <div class="option" data-team="left" data-value="3" onclick="toggleTeamOption('left', this)">3</div>
                        <div class="option" data-team="left" data-value="4" onclick="toggleTeamOption('left', this)">4</div>
                        <div class="option" data-team="left" data-value="5" onclick="toggleTeamOption('left', this)">5</div>
                        <div class="option" data-team="left" data-value="9" onclick="toggleTeamOption('left', this)">9</div>
                        <div class="option" data-team="left" data-value="10" onclick="toggleTeamOption('left', this)">10</div>
                        <div class="option" data-team="left" data-value="11" onclick="toggleTeamOption('left', this)">11</div>
                        <div class="option" data-team="left" data-value="none" onclick="toggleTeamNoneOption('left', this)">éƒ½ä¸æ˜¯</div>
                    </div>
                    
                    <button class="submit-btn" onclick="submitTeamAnswer('left')" id="leftSubmitBtn">æäº¤ç­”æ¡ˆ</button>
                    <div class="waiting-indicator" id="leftWaiting" style="display: none;">ç­‰å¾…å°æ‰‹...</div>
                </div>
                
                <div class="vs-divider">VS</div>
                
                <!-- å³éšŠå€åŸŸ -->
                <div class="team-area team-right">
                    <div class="team-header">
                        <div class="team-name" id="rightTeamDisplay">å³éšŠ</div>
                        <div class="team-score">åˆ†æ•¸: <span id="rightScore">0</span></div>
                    </div>
                    
                    <div class="question-display">
                        <div class="number-display" id="rightNumber">123</div>
                        <div class="question-text">è«‹é¸æ“‡é€™å€‹æ•¸å­—æ˜¯ä»¥ä¸‹å“ªäº›æ•¸çš„å€æ•¸ï¼š</div>
                        <div class="expected-count" id="rightExpectedCount">è«‹é¸æ“‡æ­£ç¢ºçš„é¸é …æ•¸é‡</div>
                    </div>
                    
                    <div class="options-grid">
                        <div class="option" data-team="right" data-value="2" onclick="toggleTeamOption('right', this)">2</div>
                        <div class="option" data-team="right" data-value="3" onclick="toggleTeamOption('right', this)">3</div>
                        <div class="option" data-team="right" data-value="4" onclick="toggleTeamOption('right', this)">4</div>
                        <div class="option" data-team="right" data-value="5" onclick="toggleTeamOption('right', this)">5</div>
                        <div class="option" data-team="right" data-value="9" onclick="toggleTeamOption('right', this)">9</div>
                        <div class="option" data-team="right" data-value="10" onclick="toggleTeamOption('right', this)">10</div>
                        <div class="option" data-team="right" data-value="11" onclick="toggleTeamOption('right', this)">11</div>
                        <div class="option" data-team="right" data-value="none" onclick="toggleTeamNoneOption('right', this)">éƒ½ä¸æ˜¯</div>
                    </div>
                    
                    <button class="submit-btn" onclick="submitTeamAnswer('right')" id="rightSubmitBtn">æäº¤ç­”æ¡ˆ</button>
                    <div class="waiting-indicator" id="rightWaiting" style="display: none;">ç­‰å¾…å°æ‰‹...</div>
                </div>
            </div>
        </div>
        
        <!-- ç­”æ¡ˆè§£æç•«é¢ -->
        <div id="answerReveal" class="answer-reveal">
            <div class="answer-content">
                <h3>ç­”æ¡ˆè§£æ</h3>
                <div id="answerContent"></div>
                <button class="continue-btn" onclick="continueGame()">ç¹¼çºŒå°æˆ°</button>
            </div>
        </div>
        
        <!-- æœ€çµ‚çµæœç•«é¢ -->
        <div id="finalResults" class="final-results">
            <div class="final-content">
                <div class="winner-announcement" id="winnerAnnouncement">éŠæˆ²çµæŸï¼</div>
                <div class="final-scores">
                    <div class="final-team-score">
                        <div class="final-team-name" id="finalLeftTeam" style="color: #00ffff;">å·¦éšŠ</div>
                        <div class="final-score-value" id="finalLeftScore" style="color: #00ffff;">0</div>
                    </div>
                    <div class="final-team-score">
                        <div class="final-team-name" id="finalRightTeam" style="color: #ff00ff;">å³éšŠ</div>
                        <div class="final-score-value" id="finalRightScore" style="color: #ff00ff;">0</div>
                    </div>
                </div>
                <button class="restart-btn" onclick="restartGame()">é‡æ–°é–‹å§‹</button>
            </div>
        </div>
    </div>

    <script>
        let gameState = {
            level: 1,
            question: 1,
            leftTeam: { name: '', score: 0, answers: [], submitted: false, streak: 0, submitTime: 0 },
            rightTeam: { name: '', score: 0, answers: [], submitted: false, streak: 0, submitTime: 0 },
            currentNumbers: { left: 0, right: 0 },
            correctAnswers: { left: [], right: [] },
            timer: 20,
            timerInterval: null,
            gameData: []
        };

        function startBattle() {
            const leftName = document.getElementById('leftTeamName').value.trim() || 'å·¦éšŠ';
            const rightName = document.getElementById('rightTeamName').value.trim() || 'å³éšŠ';
            
            gameState.leftTeam.name = leftName;
            gameState.rightTeam.name = rightName;
            
            document.getElementById('leftTeamDisplay').textContent = leftName;
            document.getElementById('rightTeamDisplay').textContent = rightName;
            
            document.getElementById('setupScreen').style.display = 'none';
            document.getElementById('battleArena').style.display = 'flex';
            
            resetGame();
            generateBattleQuestion();
            startTimer();
        }

        function resetGame() {
            gameState = {
                level: 1,
                question: 1,
                leftTeam: { name: gameState.leftTeam.name, score: 0, answers: [], submitted: false, streak: 0, submitTime: 0 },
                rightTeam: { name: gameState.rightTeam.name, score: 0, answers: [], submitted: false, streak: 0, submitTime: 0 },
                currentNumbers: { left: 0, right: 0 },
                correctAnswers: { left: [], right: [] },
                timer: 20,
                timerInterval: null,
                gameData: []
            };
            updateUI();
        }

        function generateRandomNumber(level) {
            let digits;
            switch(level) {
                case 1: digits = 3; break;
                case 2: digits = 4; break;
                case 3: digits = 6; break;
            }
            
            const min = Math.pow(10, digits - 1);
            const max = Math.pow(10, digits) - 1;
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function checkMultiples(num) {
            const multiples = [];
            const divisors = [2, 3, 4, 5, 9, 10, 11];
            
            divisors.forEach(div => {
                if (num % div === 0) {
                    multiples.push(div.toString());
                }
            });
            
            return multiples.length > 0 ? multiples : ['none'];
        }

        function getDivisibilityMethod(num, divisor) {
            switch(divisor) {
                case 2:
                    return `æœ«ä½${num % 10}${num % 2 === 0 ? 'æ˜¯å¶æ•¸â†’æ˜¯' : 'æ˜¯å¥‡æ•¸â†’ä¸æ˜¯'}2çš„å€æ•¸`;
                case 3:
                    const digitSum3 = num.toString().split('').reduce((sum, digit) => sum + parseInt(digit), 0);
                    return `æ•¸å­—å’Œ${digitSum3}${digitSum3 % 3 === 0 ? 'Ã·3=æ•´æ•¸â†’æ˜¯' : 'Ã·3â‰ æ•´æ•¸â†’ä¸æ˜¯'}3çš„å€æ•¸`;
                case 4:
                    const lastTwo = num % 100;
                    return `æœ«å…©ä½${lastTwo}${lastTwo % 4 === 0 ? 'Ã·4=æ•´æ•¸â†’æ˜¯' : 'Ã·4â‰ æ•´æ•¸â†’ä¸æ˜¯'}4çš„å€æ•¸`;
                case 5:
                    const lastDigit = num % 10;
                    return `æœ«ä½${lastDigit}${lastDigit === 0 || lastDigit === 5 ? 'æ˜¯0æˆ–5â†’æ˜¯' : 'ä¸æ˜¯0æˆ–5â†’ä¸æ˜¯'}5çš„å€æ•¸`;
                case 9:
                    const digitSum9 = num.toString().split('').reduce((sum, digit) => sum + parseInt(digit), 0);
                    return `æ•¸å­—å’Œ${digitSum9}${digitSum9 % 9 === 0 ? 'Ã·9=æ•´æ•¸â†’æ˜¯' : 'Ã·9â‰ æ•´æ•¸â†’ä¸æ˜¯'}9çš„å€æ•¸`;
                case 10:
                    return `æœ«ä½${num % 10}${num % 10 === 0 ? 'æ˜¯0â†’æ˜¯' : 'ä¸æ˜¯0â†’ä¸æ˜¯'}10çš„å€æ•¸`;
                case 11:
                    const numStr = num.toString();
                    let oddSum = 0, evenSum = 0;
                    for(let i = 0; i < numStr.length; i++) {
                        if(i % 2 === 0) oddSum += parseInt(numStr[i]);
                        else evenSum += parseInt(numStr[i]);
                    }
                    const diff = Math.abs(oddSum - evenSum);
                    return `å¥‡å¶ä½å·®å€¼${diff}${diff % 11 === 0 ? 'Ã·11=æ•´æ•¸â†’æ˜¯' : 'Ã·11â‰ æ•´æ•¸â†’ä¸æ˜¯'}11çš„å€æ•¸`;
                default:
                    return '';
            }
        }

        function generateBattleQuestion() {
            // å…©éšŠç”Ÿæˆä¸åŒçš„æ•¸å­—
            gameState.currentNumbers.left = generateRandomNumber(gameState.level);
            gameState.currentNumbers.right = generateRandomNumber(gameState.level);
            
            gameState.correctAnswers.left = checkMultiples(gameState.currentNumbers.left);
            gameState.correctAnswers.right = checkMultiples(gameState.currentNumbers.right);
            
            gameState.leftTeam.answers = [];
            gameState.rightTeam.answers = [];
            gameState.leftTeam.submitted = false;
            gameState.rightTeam.submitted = false;
            gameState.leftTeam.submitTime = 0;
            gameState.rightTeam.submitTime = 0;
            gameState.timer = 20;
            
            // æ›´æ–°é¡¯ç¤º
            document.getElementById('leftNumber').textContent = gameState.currentNumbers.left;
            document.getElementById('rightNumber').textContent = gameState.currentNumbers.right;
            
            document.getElementById('leftExpectedCount').textContent = 
                gameState.correctAnswers.left.includes('none') ? 'è«‹é¸æ“‡1é …' : `è«‹é¸æ“‡${gameState.correctAnswers.left.length}é …`;
            document.getElementById('rightExpectedCount').textContent = 
                gameState.correctAnswers.right.includes('none') ? 'è«‹é¸æ“‡1é …' : `è«‹é¸æ“‡${gameState.correctAnswers.right.length}é …`;
            
            // é‡ç½®æ‰€æœ‰é¸é …
            document.querySelectorAll('.option').forEach(opt => {
                opt.classList.remove('selected', 'none-selected');
            });
            
            // é‡ç½®æŒ‰éˆ•ç‹€æ…‹
            document.getElementById('leftSubmitBtn').disabled = false;
            document.getElementById('rightSubmitBtn').disabled = false;
            document.getElementById('leftWaiting').style.display = 'none';
            document.getElementById('rightWaiting').style.display = 'none';
            
            updateUI();
        }

        function toggleTeamOption(team, element) {
            const value = element.getAttribute('data-value');
            
            if (value === 'none') {
                toggleTeamNoneOption(team, element);
                return;
            }
            
            // å¦‚æœå·²é¸æ“‡"éƒ½ä¸æ˜¯"ï¼Œå…ˆå–æ¶ˆé¸æ“‡
            const noneOption = document.querySelector(`[data-team="${team}"][data-value="none"]`);
            if (noneOption.classList.contains('none-selected')) {
                noneOption.classList.remove('none-selected');
                const teamState = team === 'left' ? gameState.leftTeam : gameState.rightTeam;
                teamState.answers = teamState.answers.filter(v => v !== 'none');
            }
            
            const teamState = team === 'left' ? gameState.leftTeam : gameState.rightTeam;
            
            if (element.classList.contains('selected')) {
                element.classList.remove('selected');
                teamState.answers = teamState.answers.filter(v => v !== value);
            } else {
                element.classList.add('selected');
                teamState.answers.push(value);
            }
        }

        function toggleTeamNoneOption(team, element) {
            const teamState = team === 'left' ? gameState.leftTeam : gameState.rightTeam;
            
            // æ¸…é™¤å…¶ä»–æ‰€æœ‰é¸é …
            document.querySelectorAll(`[data-team="${team}"]`).forEach(opt => {
                if (opt !== element) {
                    opt.classList.remove('selected', 'none-selected');
                }
            });
            
            if (element.classList.contains('none-selected')) {
                element.classList.remove('none-selected');
                teamState.answers = [];
            } else {
                element.classList.add('none-selected');
                teamState.answers = ['none'];
            }
        }

        function submitTeamAnswer(team) {
            const teamState = team === 'left' ? gameState.leftTeam : gameState.rightTeam;
            teamState.submitted = true;
            teamState.submitTime = 20 - gameState.timer; // è¨˜éŒ„ç­”é¡Œæ™‚é–“
            
            // ç¦ç”¨è©²éšŠçš„æäº¤æŒ‰éˆ•ä¸¦é¡¯ç¤ºç­‰å¾…
            document.getElementById(`${team}SubmitBtn`).disabled = true;
            document.getElementById(`${team}Waiting`).style.display = 'block';
            
            // æª¢æŸ¥æ˜¯å¦å…©éšŠéƒ½å·²æäº¤
            if (gameState.leftTeam.submitted && gameState.rightTeam.submitted) {
                clearInterval(gameState.timerInterval);
                calculateScores();
                showAnswerReveal();
            }
        }

        function calculateScores() {
            // è¨ˆç®—å·¦éšŠå¾—åˆ†
            const leftCorrect = arraysEqual(
                gameState.leftTeam.answers.sort(), 
                gameState.correctAnswers.left.sort()
            );
            let leftScore = 0;
            if (leftCorrect) {
                // åŸºç¤åˆ†æ•¸10åˆ†
                leftScore = 10;
                // æ™‚é–“åŠ åˆ†ï¼šæ„ˆå¿«ç­”å°å¾—åˆ†æ„ˆé«˜ (æœ€å¤šé¡å¤–5åˆ†)
                const timeBonus = Math.max(0, Math.floor((20 - gameState.leftTeam.submitTime) / 4));
                leftScore += timeBonus;
                // é€£çºŒç­”å°åŠ åˆ†
                gameState.leftTeam.streak++;
                const streakBonus = Math.min(gameState.leftTeam.streak - 1, 3); // æœ€å¤šé¡å¤–3åˆ†
                leftScore += streakBonus;
            } else {
                gameState.leftTeam.streak = 0; // é‡ç½®é€£å‹
            }
            gameState.leftTeam.score += leftScore;
            
            // è¨ˆç®—å³éšŠå¾—åˆ†
            const rightCorrect = arraysEqual(
                gameState.rightTeam.answers.sort(), 
                gameState.correctAnswers.right.sort()
            );
            let rightScore = 0;
            if (rightCorrect) {
                // åŸºç¤åˆ†æ•¸10åˆ†
                rightScore = 10;
                // æ™‚é–“åŠ åˆ†ï¼šæ„ˆå¿«ç­”å°å¾—åˆ†æ„ˆé«˜ (æœ€å¤šé¡å¤–5åˆ†)
                const timeBonus = Math.max(0, Math.floor((20 - gameState.rightTeam.submitTime) / 4));
                rightScore += timeBonus;
                // é€£çºŒç­”å°åŠ åˆ†
                gameState.rightTeam.streak++;
                const streakBonus = Math.min(gameState.rightTeam.streak - 1, 3); // æœ€å¤šé¡å¤–3åˆ†
                rightScore += streakBonus;
            } else {
                gameState.rightTeam.streak = 0; // é‡ç½®é€£å‹
            }
            gameState.rightTeam.score += rightScore;
            
            // è¨˜éŒ„éŠæˆ²è³‡æ–™
            gameState.gameData.push({
                level: gameState.level,
                question: gameState.question,
                left: {
                    number: gameState.currentNumbers.left,
                    userAnswers: [...gameState.leftTeam.answers],
                    correctAnswers: [...gameState.correctAnswers.left],
                    score: leftScore,
                    isCorrect: leftCorrect,
                    submitTime: gameState.leftTeam.submitTime,
                    streak: gameState.leftTeam.streak
                },
                right: {
                    number: gameState.currentNumbers.right,
                    userAnswers: [...gameState.rightTeam.answers],
                    correctAnswers: [...gameState.correctAnswers.right],
                    score: rightScore,
                    isCorrect: rightCorrect,
                    submitTime: gameState.rightTeam.submitTime,
                    streak: gameState.rightTeam.streak
                }
            });
        }

        function showAnswerReveal() {
            const lastData = gameState.gameData[gameState.gameData.length - 1];
            
            let answerHTML = `
                <div style="display: flex; gap: 30px; margin-bottom: 30px;">
                    <div style="flex: 1;">
                        <h4 style="color: #00ffff; margin-bottom: 15px;">${gameState.leftTeam.name}</h4>
                        <div class="team-result ${lastData.left.isCorrect ? 'correct' : 'incorrect'}">
                            <div>
                                <strong>æ•¸å­—: ${lastData.left.number}</strong><br>
                                ç­”æ¡ˆ: ${lastData.left.userAnswers.includes('none') ? 'éƒ½ä¸æ˜¯' : 
                                    lastData.left.userAnswers.length > 0 ? 
                                    lastData.left.userAnswers.map(ans => `${ans}çš„å€æ•¸`).join(', ') : 'æœªé¸æ“‡'}<br>
                                æ­£ç¢º: ${lastData.left.correctAnswers.includes('none') ? 'éƒ½ä¸æ˜¯' : 
                                    lastData.left.correctAnswers.map(ans => `${ans}çš„å€æ•¸`).join(', ')}<br>
                                <small style="color: #aaa;">ç­”é¡Œæ™‚é–“: ${lastData.left.submitTime}ç§’ | é€£å‹: ${lastData.left.streak}é¡Œ</small>
                            </div>
                            <div style="font-size: 1.5rem; font-weight: 900;">
                                ${lastData.left.isCorrect ? `âœ“ +${lastData.left.score}` : 'âœ— +0'}
                            </div>
                        </div>
                    </div>
                    <div style="flex: 1;">
                        <h4 style="color: #ff00ff; margin-bottom: 15px;">${gameState.rightTeam.name}</h4>
                        <div class="team-result ${lastData.right.isCorrect ? 'correct' : 'incorrect'}">
                            <div>
                                <strong>æ•¸å­—: ${lastData.right.number}</strong><br>
                                ç­”æ¡ˆ: ${lastData.right.userAnswers.includes('none') ? 'éƒ½ä¸æ˜¯' : 
                                    lastData.right.userAnswers.length > 0 ? 
                                    lastData.right.userAnswers.map(ans => `${ans}çš„å€æ•¸`).join(', ') : 'æœªé¸æ“‡'}<br>
                                æ­£ç¢º: ${lastData.right.correctAnswers.includes('none') ? 'éƒ½ä¸æ˜¯' : 
                                    lastData.right.correctAnswers.map(ans => `${ans}çš„å€æ•¸`).join(', ')}<br>
                                <small style="color: #aaa;">ç­”é¡Œæ™‚é–“: ${lastData.right.submitTime}ç§’ | é€£å‹: ${lastData.right.streak}é¡Œ</small>
                            </div>
                            <div style="font-size: 1.5rem; font-weight: 900;">
                                ${lastData.right.isCorrect ? `âœ“ +${lastData.right.score}` : 'âœ— +0'}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // é¡¯ç¤ºåˆ¤åˆ¥æ–¹æ³• (å·¦éšŠæ•¸å­—)
            const divisors = [2, 3, 4, 5, 9, 10, 11];
            answerHTML += `<div style="margin-top: 30px;"><strong style="color: #ffff00;">åˆ¤åˆ¥æ–¹æ³• (${gameState.leftTeam.name} - ${lastData.left.number})ï¼š</strong></div>`;
            
            divisors.forEach(divisor => {
                const method = getDivisibilityMethod(lastData.left.number, divisor);
                answerHTML += `
                    <div class="method-section">
                        <strong>${divisor}çš„å€æ•¸åˆ¤åˆ¥ï¼š</strong><br>
                        <div class="method-text">${method}</div>
                    </div>
                `;
            });
            
            // é¡¯ç¤ºåˆ¤åˆ¥æ–¹æ³• (å³éšŠæ•¸å­—)
            answerHTML += `<div style="margin-top: 30px;"><strong style="color: #ffff00;">åˆ¤åˆ¥æ–¹æ³• (${gameState.rightTeam.name} - ${lastData.right.number})ï¼š</strong></div>`;
            
            divisors.forEach(divisor => {
                const method = getDivisibilityMethod(lastData.right.number, divisor);
                answerHTML += `
                    <div class="method-section">
                        <strong>${divisor}çš„å€æ•¸åˆ¤åˆ¥ï¼š</strong><br>
                        <div class="method-text">${method}</div>
                    </div>
                `;
            });
            
            document.getElementById('answerContent').innerHTML = answerHTML;
            document.getElementById('answerReveal').style.display = 'flex';
        }

        function continueGame() {
            document.getElementById('answerReveal').style.display = 'none';
            
            if (gameState.question < 6) {
                gameState.question++;
                generateBattleQuestion();
                startTimer();
            } else if (gameState.level < 3) {
                gameState.level++;
                gameState.question = 1;
                generateBattleQuestion();
                startTimer();
            } else {
                showFinalResults();
            }
        }

        function showFinalResults() {
            const leftFinalScore = gameState.leftTeam.score;
            const rightFinalScore = gameState.rightTeam.score;
            
            let winnerText;
            if (leftFinalScore > rightFinalScore) {
                winnerText = `ğŸ† ${gameState.leftTeam.name} ç²å‹ï¼`;
            } else if (rightFinalScore > leftFinalScore) {
                winnerText = `ğŸ† ${gameState.rightTeam.name} ç²å‹ï¼`;
            } else {
                winnerText = `ğŸ¤ å¹³æ‰‹ï¼`;
            }
            
            document.getElementById('winnerAnnouncement').textContent = winnerText;
            document.getElementById('finalLeftTeam').textContent = gameState.leftTeam.name;
            document.getElementById('finalRightTeam').textContent = gameState.rightTeam.name;
            document.getElementById('finalLeftScore').textContent = leftFinalScore;
            document.getElementById('finalRightScore').textContent = rightFinalScore;
            
            document.getElementById('finalResults').style.display = 'flex';
        }

        function startTimer() {
            gameState.timer = 20;
            updateTimer();
            
            gameState.timerInterval = setInterval(() => {
                gameState.timer--;
                updateTimer();
                
                if (gameState.timer <= 5) {
                    document.getElementById('timerDisplay').classList.add('warning');
                }
                
                if (gameState.timer <= 0) {
                    // æ™‚é–“åˆ°ï¼Œè‡ªå‹•æäº¤é‚„æ²’æäº¤çš„éšŠä¼
                    if (!gameState.leftTeam.submitted) {
                        gameState.leftTeam.submitTime = 20; // æ™‚é–“åˆ°çš„è©±è¨˜éŒ„ç‚º20ç§’
                        submitTeamAnswer('left');
                    }
                    if (!gameState.rightTeam.submitted) {
                        gameState.rightTeam.submitTime = 20; // æ™‚é–“åˆ°çš„è©±è¨˜éŒ„ç‚º20ç§’
                        submitTeamAnswer('right');
                    }
                }
            }, 1000);
        }

        function updateTimer() {
            document.getElementById('timerDisplay').textContent = gameState.timer;
            if (gameState.timer > 5) {
                document.getElementById('timerDisplay').classList.remove('warning');
            }
        }

        function updateUI() {
            document.getElementById('currentLevel').textContent = gameState.level;
            document.getElementById('currentQuestion').textContent = gameState.question;
            document.getElementById('leftScore').textContent = gameState.leftTeam.score;
            document.getElementById('rightScore').textContent = gameState.rightTeam.score;
        }

        function arraysEqual(a, b) {
            return a.length === b.length && a.every((val, i) => val === b[i]);
        }

        function restartGame() {
            document.getElementById('finalResults').style.display = 'none';
            document.getElementById('battleArena').style.display = 'none';
            document.getElementById('setupScreen').style.display = 'block';
            
            // æ¸…ç©ºè¼¸å…¥æ¡†
            document.getElementById('leftTeamName').value = '';
            document.getElementById('rightTeamName').value = '';
        }
    </script>
</body>
</html>
